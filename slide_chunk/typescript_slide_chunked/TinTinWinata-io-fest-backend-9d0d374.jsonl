{"filename": "prisma/seed.ts", "chunked_list": ["import { PrismaClient } from '@prisma/client';\nimport { hash } from 'bcrypt';\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { createForum } from '../src/databases/forum.database';\n\nconst prisma = new PrismaClient();\n\ninterface IExampleText {\n  title: string;\n  description: string;\n}\n\nconst EXAMPLE_TEXT: IExampleText[] = [\n  {\n    title: 'Makanan dan vitamin yang dapat mencegah menopause dini',\n    description:\n      'Maaf dokter, saya ingin bertanya, dulu mama saya menopause saat usianya 52 tahun. Sekarang usia saya 39 tahun saya haidnya sekarang 3 hari, saya takut ini adalah gejala menopause dini. Cara mencegah menopause dini itu saya harus bagaimana dok? apakah ada makanan atau vitamin yag bisa saya konsumsi rutin sbg pencegahan?',\n  },\n  {\n    title:\n      'Bolehkah menggunakan obat amoxicillin untuk sakit gigi akibat gusi bengkak?',\n    description:\n      'bu saya lagi sakit gigi dan biasanya saya kalo lagi sakit gigi saya minumin amoxicillin.. kalo saya kasihkan ke ibu saya apakah boleh dok?',\n  },\n  {\n    title: 'Muncul gumpalan darah setelah cabut jahitan luka',\n    description:\n      'Alodokter., maaf dok mau nanya. Saya sebulan lalu kecelakaan dan kaki saya robek 10 cm dan mendapat jahitan 8 jahitan. ini udaah waktunya saya kontrol untuk cabut jahitan luka saya ini pas di cabut jahitannya kok malah keluar gumpalan darah. Saya takut dok, ini kenapa dengan luka saya dok?',\n  },\n  {\n    title: 'Penyebab perut bunyi saat sedang hamil trimester 1',\n    description:\n      'Halo dok, saya perempuan 27 tahun. Saat ini sedang hamil 2 bulan ini kehamilan perama saya dok. Saya mau tanya dok, kenapa ya, sudah 2 hari ini perut saya sering bunyi. padahal saya udah makan atau sedang tidak lapar dok. Apakah perut bunyi pada ibu hamil itu normal dok? bisa tolong jelaskan penyebabnya apa dan apa yg harus saya lakukan untuk mengatasinya dok? terima kasih',\n  },\n  {\n    title: 'Penyebab nyeri perut kiri bawah saat hamil 4 bulan',\n    description:\n      'Ijin ganggu dok, saya mau nanya. saya bumil 4 bulan. jadi gini dok perut kiri bawah saya suka nyeri. ini kejadian udah semenjak seminggu lalu sampe sekarang nih dokter. nyerinya itu kadang berlangsung seharian dan hilang timbul. Apakah ini kelainan apa normal dialami bumil usia 4 bulan dok? bagaimana cara mengatasi sakit perut sebelah kiri bawah saat hamil ya?',\n  },\n  {\n    title: 'Rekomendasi minuman pereda sakit kepala hingga mual',\n    description:\n      'Selamat siang , dok saya wanita pekerja kantoran, saya sering kali sakit kepala di pelipis / migrain hingga tengkuk bagian kanan jg terasa gak nyaman dokter. terkadang sakitnya itu bisa menimbulkan saya mual-mual dok. mau nanya minuman pereda sakit kepala untuk sakit saya ini dong dokter. makasih',\n  },\n  {\n    title:\n      'Positif hamil setelah mengalami keguguran 2 kali, bagaimana agar janin tetap sehat?',\n    description:\n      'Jadi gini dok, saya udah nikah 3 tahun, selama itu saya udah keguguran 2x. Sekarang saya telat haid pas di testpack hasilnya positif. Saya pas keguguran dulu itu di usia kehamilan 7 minggu dan 8 minggu. Saya khawatir ini akan kejadian yg kaya dulu lagi. Minta saran dong dokter. Agar kehamilan saya ini baik-baik saja dan tetep sehat sampe bayi lahir. terima kasih',\n  },\n  {\n    title: 'Apa penyebab vagina gatal dan keputihan berwarna kuning?',\n    description:\n      'Maaf dok, sebelumnya ini agak jorok. saya wanita 27 th, belum menikah. Dalam seminggu ini vagina saya keputihan, keputihannya kuning, baunya gada, cuma di dalam vagina saya rasanya gatal sekali. Saya pake rebusan daun sirih enakan pas di pake cebok pertama kali aja. keputihan dan gatalnya masih gak enak ini dok. Apa penyebabnya dok? san obat yang ampuh untuk saya ini obat apa?',\n  },\n  {\n    title:\n      'Bagaimanakah cara menghilangkan varises dengan menggunakan es batu?',\n    description:\n      'Selamat siang dok, saya seorang atlit dok, saya punya varises di kaki saya bagian belakang dok. Kata orang bisa ilangin varises pake batu es.. Apakah benar ya dok dengan mengkompres kaki dengan batu es dapat menghilangkan sakit varises? kalau memang iya, apakah baik jikalau selama habis lari langsung dikompres pakai batu es. dan satu lagi dok, tolong penjelasan dimana tepatnya yg harus dikompres pada bagian kaki? Terimakasi banyak dok atas jawabannya',\n  },\n  {\n    title:\n      'Adakah cara lain selain konsumsi antibiotik untuk mengatasi radang panggul?',\n    description:\n      'Selamat Pagi Dok, Istri Saya sudah cek ke RS dan katanya dia kenak Radang Panggul.. Dari dokter dikasihkan obat antibiotik untuk 2 minggu.. pertanyaan saya dok, Apakah ada solusi Lain selain meminum Obat AntiBiotik yang diberikan oleh rumah sakit? selain untuk mencegah Hal yang tidak saya inginkan untuk Istri saya,.karena hampir tiap hari Istri Saya merasa sakit di sekitaran Panggul nya Dok,.Mohon di jawab & di respon ya Dok',\n  },\n];\n", "interface IExampleText {\n  title: string;\n  description: string;\n}\n\nconst EXAMPLE_TEXT: IExampleText[] = [\n  {\n    title: 'Makanan dan vitamin yang dapat mencegah menopause dini',\n    description:\n      'Maaf dokter, saya ingin bertanya, dulu mama saya menopause saat usianya 52 tahun. Sekarang usia saya 39 tahun saya haidnya sekarang 3 hari, saya takut ini adalah gejala menopause dini. Cara mencegah menopause dini itu saya harus bagaimana dok? apakah ada makanan atau vitamin yag bisa saya konsumsi rutin sbg pencegahan?',\n  },\n  {\n    title:\n      'Bolehkah menggunakan obat amoxicillin untuk sakit gigi akibat gusi bengkak?',\n    description:\n      'bu saya lagi sakit gigi dan biasanya saya kalo lagi sakit gigi saya minumin amoxicillin.. kalo saya kasihkan ke ibu saya apakah boleh dok?',\n  },\n  {\n    title: 'Muncul gumpalan darah setelah cabut jahitan luka',\n    description:\n      'Alodokter., maaf dok mau nanya. Saya sebulan lalu kecelakaan dan kaki saya robek 10 cm dan mendapat jahitan 8 jahitan. ini udaah waktunya saya kontrol untuk cabut jahitan luka saya ini pas di cabut jahitannya kok malah keluar gumpalan darah. Saya takut dok, ini kenapa dengan luka saya dok?',\n  },\n  {\n    title: 'Penyebab perut bunyi saat sedang hamil trimester 1',\n    description:\n      'Halo dok, saya perempuan 27 tahun. Saat ini sedang hamil 2 bulan ini kehamilan perama saya dok. Saya mau tanya dok, kenapa ya, sudah 2 hari ini perut saya sering bunyi. padahal saya udah makan atau sedang tidak lapar dok. Apakah perut bunyi pada ibu hamil itu normal dok? bisa tolong jelaskan penyebabnya apa dan apa yg harus saya lakukan untuk mengatasinya dok? terima kasih',\n  },\n  {\n    title: 'Penyebab nyeri perut kiri bawah saat hamil 4 bulan',\n    description:\n      'Ijin ganggu dok, saya mau nanya. saya bumil 4 bulan. jadi gini dok perut kiri bawah saya suka nyeri. ini kejadian udah semenjak seminggu lalu sampe sekarang nih dokter. nyerinya itu kadang berlangsung seharian dan hilang timbul. Apakah ini kelainan apa normal dialami bumil usia 4 bulan dok? bagaimana cara mengatasi sakit perut sebelah kiri bawah saat hamil ya?',\n  },\n  {\n    title: 'Rekomendasi minuman pereda sakit kepala hingga mual',\n    description:\n      'Selamat siang , dok saya wanita pekerja kantoran, saya sering kali sakit kepala di pelipis / migrain hingga tengkuk bagian kanan jg terasa gak nyaman dokter. terkadang sakitnya itu bisa menimbulkan saya mual-mual dok. mau nanya minuman pereda sakit kepala untuk sakit saya ini dong dokter. makasih',\n  },\n  {\n    title:\n      'Positif hamil setelah mengalami keguguran 2 kali, bagaimana agar janin tetap sehat?',\n    description:\n      'Jadi gini dok, saya udah nikah 3 tahun, selama itu saya udah keguguran 2x. Sekarang saya telat haid pas di testpack hasilnya positif. Saya pas keguguran dulu itu di usia kehamilan 7 minggu dan 8 minggu. Saya khawatir ini akan kejadian yg kaya dulu lagi. Minta saran dong dokter. Agar kehamilan saya ini baik-baik saja dan tetep sehat sampe bayi lahir. terima kasih',\n  },\n  {\n    title: 'Apa penyebab vagina gatal dan keputihan berwarna kuning?',\n    description:\n      'Maaf dok, sebelumnya ini agak jorok. saya wanita 27 th, belum menikah. Dalam seminggu ini vagina saya keputihan, keputihannya kuning, baunya gada, cuma di dalam vagina saya rasanya gatal sekali. Saya pake rebusan daun sirih enakan pas di pake cebok pertama kali aja. keputihan dan gatalnya masih gak enak ini dok. Apa penyebabnya dok? san obat yang ampuh untuk saya ini obat apa?',\n  },\n  {\n    title:\n      'Bagaimanakah cara menghilangkan varises dengan menggunakan es batu?',\n    description:\n      'Selamat siang dok, saya seorang atlit dok, saya punya varises di kaki saya bagian belakang dok. Kata orang bisa ilangin varises pake batu es.. Apakah benar ya dok dengan mengkompres kaki dengan batu es dapat menghilangkan sakit varises? kalau memang iya, apakah baik jikalau selama habis lari langsung dikompres pakai batu es. dan satu lagi dok, tolong penjelasan dimana tepatnya yg harus dikompres pada bagian kaki? Terimakasi banyak dok atas jawabannya',\n  },\n  {\n    title:\n      'Adakah cara lain selain konsumsi antibiotik untuk mengatasi radang panggul?',\n    description:\n      'Selamat Pagi Dok, Istri Saya sudah cek ke RS dan katanya dia kenak Radang Panggul.. Dari dokter dikasihkan obat antibiotik untuk 2 minggu.. pertanyaan saya dok, Apakah ada solusi Lain selain meminum Obat AntiBiotik yang diberikan oleh rumah sakit? selain untuk mencegah Hal yang tidak saya inginkan untuk Istri saya,.karena hampir tiap hari Istri Saya merasa sakit di sekitaran Panggul nya Dok,.Mohon di jawab & di respon ya Dok',\n  },\n];\n", "async function main() {\n  const saltRounds = 10;\n\n  const testUser = await prisma.user.upsert({\n    where: { email: 'test@gmail.com' },\n    update: {},\n    create: {\n      email: 'member@gmail.com',\n      name: 'Mayalinda',\n      password: await hash('member', saltRounds),\n      username: 'Maya',\n      profilePicture: '/profile.webp',\n      isActive: true,\n      role: 'Member',\n    },\n  });\n  const testUser1 = await prisma.user.upsert({\n    where: { email: 'doctor@gmail.com' },\n    update: {},\n    create: {\n      email: 'doctor@gmail.com',\n      name: 'Doctor',\n      password: await hash('doctor', saltRounds),\n      username: 'Doctor',\n      profilePicture: '/profile.webp',\n      isActive: true,\n      role: 'Doctor',\n    },\n  });\n  const testUser2 = await prisma.user.upsert({\n    where: { email: 'admin@gmail.com' },\n    update: {},\n    create: {\n      email: 'admin@gmail.com',\n      name: 'Admin',\n      password: await hash('admin', saltRounds),\n      username: 'Admin',\n      profilePicture: '/profile.webp',\n      isActive: true,\n      role: 'Admin',\n    },\n  });\n  EXAMPLE_TEXT.map(async (text) => {\n    const forum = await createForum({\n      id: uuidv4(),\n      title: text.title,\n      description: text.description,\n      userId: testUser.id,\n      seen: 0,\n      createdAt: new Date(Date.now()),\n      updatedAt: new Date(Date.now()),\n    });\n  });\n\n  // !Debugging Purpose\n}\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })", "  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n"]}
{"filename": "prisma/prisma.client.ts", "chunked_list": ["import { PrismaClient } from \"@prisma/client\";\n\nclass DBClient {\n  public prisma: PrismaClient;\n  private static instance: DBClient;\n  \n  private constructor() {\n    this.prisma = new PrismaClient();\n  }\n\n  public static getInstance = () => {", "    if (!DBClient.instance) {\n      DBClient.instance = new DBClient();\n    }\n    return DBClient.instance;\n  };\n}\n\nexport default DBClient;\n"]}
{"filename": "src/index.ts", "chunked_list": ["import bodyParser from 'body-parser';\nimport compression from 'compression';\nimport cookieParser from 'cookie-parser';\nimport cors from 'cors';\nimport express, { Request, Response } from 'express';\nimport createError from 'http-errors';\nimport router from './routes';\n\ndeclare global {\n  namespace Express {\n    export interface Request {\n      jwtPayload?: any;\n      fileValidationError?: string;\n    }\n  }\n}\n\nconst app = express();\n\napp.use(\n  cors({\n    origin: 'http://localhost:5173',\n    credentials: true,\n  })\n);\n\napp.use(bodyParser.json());\napp.use(\n  bodyParser.urlencoded({\n    extended: true,\n  })\n);\napp.use(compression());\napp.use(cookieParser());\napp.use(express.json());\n\napp.use('/', router);\n\napp.use((req: Request, res: Response, next: Function) => {\n  next(createError(404));\n});\n\napp.listen(3000, () =>\n  console.log(`\u26a1\ufe0f[server]: Server is running at https://localhost:3000`)\n);\n", "declare global {\n  namespace Express {\n    export interface Request {\n      jwtPayload?: any;\n      fileValidationError?: string;\n    }\n  }\n}\n\nconst app = express();\n\napp.use(\n  cors({\n    origin: 'http://localhost:5173',\n    credentials: true,\n  })\n);\n\napp.use(bodyParser.json());\napp.use(\n  bodyParser.urlencoded({\n    extended: true,\n  })\n);\napp.use(compression());\napp.use(cookieParser());\napp.use(express.json());\n\napp.use('/', router);\n\napp.use((req: Request, res: Response, next: Function) => {\n  next(createError(404));\n});\n\napp.listen(3000, () =>\n  console.log(`\u26a1\ufe0f[server]: Server is running at https://localhost:3000`)\n);\n"]}
{"filename": "src/facades/helper.ts", "chunked_list": ["import fs from 'fs';\nimport nodemailer from 'nodemailer';\nimport { MailOptions } from 'nodemailer/lib/sendmail-transport';\nimport { PaginationOptions } from '../interfaces/interface';\n\nexport const sendEmail = async (\n  email: string,\n  activationLinkId: string\n): Promise<boolean> => {\n  const transporter = nodemailer.createTransport({", "): Promise<boolean> => {\n  const transporter = nodemailer.createTransport({\n    service: 'gmail',\n    auth: {\n      user: process.env.EMAIL_SENDER,\n      pass: process.env.EMAIL_SENDER_PASSWORD,\n    },\n  });\n\n  const mailOptions: MailOptions = {", "\n  const mailOptions: MailOptions = {\n    from: process.env.EMAIL_SENDER,\n    to: email,\n    subject: 'CariTahu - Account Verification',\n    html: `<div id=\":15g\" class=\"a3s aiL msg-2564905172801731076\">\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n      <tbody>\n        <tr>\n          <td", "        <tr>\n          <td\n            bgcolor=\"#f3f4f6\"\n            align=\"center\"\n            style=\"padding: 30px 10px 10px 10px;\"\n          >\n            <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"500\">\n              <tbody>\n                <tr>\n                  <td bgcolor=\"#FAF9F7\">", "                <tr>\n                  <td bgcolor=\"#FAF9F7\">\n                    <table\n                      width=\"100%\"\n                      border=\"0\"\n                      cellspacing=\"0\"\n                      cellpadding=\"0\"\n                      style=\"width: 100% !important;\"\n                    >\n                      <tbody>", "                    >\n                      <tbody>\n                        <tr>\n                          <td align=\"center\">\n                            <table\n                              width=\"100%\"\n                              border=\"0\"\n                              cellspacing=\"0\"\n                              cellpadding=\"0\"\n                              style=\"width: 100% !important;\"", "                              cellpadding=\"0\"\n                              style=\"width: 100% !important;\"\n                            >\n                              <tbody>\n                                <tr>\n                                  <td\n                                    style=\"padding: 10px 10px 25px 10px;\"\n                                    align=\"center\"\n                                  ></td>\n                                </tr>", "                                  ></td>\n                                </tr>\n                              </tbody>\n                            </table>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td align=\"center\">\n                            <table\n                              width=\"90%\"", "                            <table\n                              width=\"90%\"\n                              border=\"0\"\n                              cellspacing=\"0\"\n                              cellpadding=\"0\"\n                            >\n                              <tbody>\n                                <tr>\n                                  <td\n                                    align=\"center\"", "                                  <td\n                                    align=\"center\"\n                                    style=\"\n                                      padding: 0px 10px 10px 10px;\n                                      font-size: 15px;\n                                      line-height: 22px;\n                                      font-family: Open Sans, Lucida,\n                                        Lucida Sans, Lucida Grande, Arial,\n                                        sans-serif !important;\n                                      color: #4b5563;", "                                        sans-serif !important;\n                                      color: #4b5563;\n                                    \"\n                                  >\n                                    <p>\n                                      Welcome to CariTahu! There's just one\n                                      more step before you get to the fun\n                                      part.\n                                    </p>\n                                    <p>", "                                    </p>\n                                    <p>\n                                      Verify your CariTahu account by clicking\n                                      on the button below:\n                                    </p>\n                                  </td>\n                                </tr>\n                              </tbody>\n                            </table>\n                          </td>", "                            </table>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td align=\"center\" style=\"padding: 0 10px 0 10px;\">\n                            <table\n                              width=\"100%\"\n                              border=\"0\"\n                              cellspacing=\"0\"\n                              cellpadding=\"0\"", "                              cellspacing=\"0\"\n                              cellpadding=\"0\"\n                            >\n                              <tbody>\n                                <tr>\n                                  <td\n                                    align=\"center\"\n                                    style=\"padding: 15px 0 35px 0;\"\n                                  >\n                                    <table", "                                  >\n                                    <table\n                                      border=\"0\"\n                                      cellspacing=\"0\"\n                                      cellpadding=\"0\"\n                                    >\n                                      <tbody>\n                                        <tr>\n                                          <td align=\"center\">\n                                            <a", "                                          <td align=\"center\">\n                                            <a\n                                              href=\"${\n                                                process.env\n                                                  .ACTIVATION_LINK_PATH +\n                                                activationLinkId\n                                              }\"\n                                              style=\"\n                                                font-size: 22px;\n                                                font-family: Open Sans, Lucida,", "                                                font-size: 22px;\n                                                font-family: Open Sans, Lucida,\n                                                  Lucida Sans, Lucida Grande,\n                                                  Arial, sans-serif !important;\n                                                font-weight: normal;\n                                                color: #ffffff;\n                                                text-decoration: none;\n                                                background-color: #2563eb;\n                                                border-top: 15px solid #2563eb;\n                                                border-bottom: 15px solid", "                                                border-top: 15px solid #2563eb;\n                                                border-bottom: 15px solid\n                                                  #2563eb;\n                                                border-left: 25px solid\n                                                  #2563eb;\n                                                border-right: 25px solid\n                                                  #2563eb;\n                                                border-radius: 3px;\n                                                display: inline-block;\n                                              \"", "                                                display: inline-block;\n                                              \"\n                                              target=\"_blank\"\n                                              data-saferedirecturl=\"https://www.google.com/url?q=https://www.CariTahu.com/core/verifyEmail?key%3D934a9d5d-0eb2-4333-a82e-80f57972f9cf&amp;source=gmail&amp;ust=1681680737787000&amp;usg=AOvVaw0LNmmPJd2-OxZUlD3whZJf\"\n                                            >\n                                              <span class=\"il\">\n                                                Verify\n                                              </span>\n                                              my account\n                                            </a>", "                                              my account\n                                            </a>\n                                          </td>\n                                        </tr>\n                                      </tbody>\n                                    </table>\n                                  </td>\n                                </tr>\n                              </tbody>\n                            </table>", "                              </tbody>\n                            </table>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td align=\"center\">\n                            <div\n                              class=\"a6S\"\n                              dir=\"ltr\"\n                              style=\"opacity: 0.01; left: 305px; top: 566px;\"", "                              dir=\"ltr\"\n                              style=\"opacity: 0.01; left: 305px; top: 566px;\"\n                            ></div>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td\n                            bgcolor=\"#FAF9F7\"\n                            align=\"center\"\n                            style=\"padding: 10px 15px 20px 15px;\"", "                            align=\"center\"\n                            style=\"padding: 10px 15px 20px 15px;\"\n                          >\n                            <table\n                              width=\"100%\"\n                              border=\"0\"\n                              cellspacing=\"0\"\n                              cellpadding=\"0\"\n                              align=\"center\"\n                              style=\"width: 100% !important;\"", "                              align=\"center\"\n                              style=\"width: 100% !important;\"\n                            >\n                              <tbody>\n                                <tr>\n                                  <td\n                                    align=\"center\"\n                                    style=\"\n                                      font-size: 15px;\n                                      line-height: 22px;", "                                      font-size: 15px;\n                                      line-height: 22px;\n                                      font-family: Open Sans, Lucida,\n                                        Lucida Sans, Lucida Grande, Arial,\n                                        sans-serif !important;\n                                      color: #4b5563;\n                                    \"\n                                  >\n                                    Thanks for using CariTahu!\n                                  </td>", "                                    Thanks for using CariTahu!\n                                  </td>\n                                </tr>\n                                <tr>\n                                  <td\n                                    align=\"center\"\n                                    style=\"padding: 5px 0 0 0;\"\n                                  >\n                                    <br />\n                                  </td>", "                                    <br />\n                                  </td>\n                                </tr>\n                              </tbody>\n                            </table>\n                          </td>\n                        </tr>\n                      </tbody>\n                    </table>\n                  </td>", "                    </table>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">", "    </table>\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n      <tbody>\n        <tr>\n          <td\n            bgcolor=\"#f3f4f6\"\n            align=\"center\"\n            style=\"padding: 10px 15px 20px 15px;\"\n          >\n            <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">", "          >\n            <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n              <tbody>\n                <tr>\n                  <td bgcolor=\"#f3f4f6\" align=\"center\">\n                    <table\n                      width=\"500\"\n                      border=\"0\"\n                      cellspacing=\"0\"\n                      cellpadding=\"0\"", "                      cellspacing=\"0\"\n                      cellpadding=\"0\"\n                      align=\"center\"\n                    >\n                      <tbody>\n                        <tr>\n                          <td\n                            align=\"center\"\n                            style=\"\n                              font-size: 14px;", "                            style=\"\n                              font-size: 14px;\n                              line-height: 16px;\n                              font-family: Open Sans, Lucida, Lucida Sans,\n                                Lucida Grande, Arial, sans-serif !important;\n                              color: #9ca3af;\n                            \"\n                          >\n                            <span\n                              style=\"color: #d1d5db; font-size: 12px;\"", "                            <span\n                              style=\"color: #d1d5db; font-size: 12px;\"\n                              class=\"m_-2564905172801731076appleFooter\"\n                            >\n                              \u00a9 2023 RE JS JT, Anggrek Campus R 600\n                            </span>\n                            <br />\n                            <br />\n                          </td>\n                        </tr>", "                          </td>\n                        </tr>\n                      </tbody>\n                    </table>\n                  </td>\n                  <td></td>\n                </tr>\n              </tbody>\n            </table>\n          </td>", "            </table>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>`,\n  };\n\n  transporter.sendMail(mailOptions, (err, info) => {\n    if (err) {\n      console.log(err);\n    } else {\n      console.log('Email sent: ' + info.response);\n      return true;\n    }\n  });\n  return false;\n};\n\nexport const getFileExtension = (fileName: string) => {\n  return '.' + fileName.split('.').pop();\n};\n\nexport const deleteFile = (filePath: string) => {\n  fs.unlink(filePath, (err) => {", "  transporter.sendMail(mailOptions, (err, info) => {\n    if (err) {\n      console.log(err);\n    } else {\n      console.log('Email sent: ' + info.response);\n      return true;\n    }\n  });\n  return false;\n};\n\nexport const getFileExtension = (fileName: string) => {\n  return '.' + fileName.split('.').pop();\n};\n\nexport const deleteFile = (filePath: string) => {\n  fs.unlink(filePath, (err) => {", "    if (err) {\n      console.error(err);\n      return;\n    }\n  });\n};\n\nexport const getPaginationOptions = (\n  page: number,\n  perPage: number\n): PaginationOptions => {\n  const skip = (page - 1) * perPage;\n  const take = perPage;\n\n  const paginationOpt: PaginationOptions = {\n    page: page,\n    perPage: perPage,\n    skip: skip,\n    take: take,\n  };\n\n  return paginationOpt;\n};\n\nexport const generateRandomString = (prefix: string): string => {\n  const randomNumber = Math.floor(Math.random() * 1000000);\n  return `${prefix}${randomNumber}`;\n};\n"]}
{"filename": "src/utils/constants.ts", "chunked_list": ["import { Secret } from \"jsonwebtoken\";\n\nexport const accessTokenSecret: Secret =\n  process.env.ACCESS_TOKEN_SECRET || \"mbVBFoeO40bcE3AilczmnM7IcQY0xWQwsC7Hbuqu\";\nexport const refreshTokenSecret: Secret =\n  process.env.REFRESH_TOKEN_SECRET ||\n  \"CkwmqZBk2e8HPkwsxi0lbZrvqej7BYpmNmTvJZTL\";\n\nexport const profilePictureRelativePath: string =\n  \"./src/public/profilePicture/\";", "export const profilePictureRelativePath: string =\n  \"./src/public/profilePicture/\";\n\nexport const forumRelativePath: string = \"./src/public/forum/\";\n\nexport const maxForumAttachmentCount: number = 8;\n\nexport const forumPerPage: number = 6;\n", ""]}
{"filename": "src/interfaces/interface.ts", "chunked_list": ["export interface PaginationOptions {\n  page: number;\n  perPage: number;\n  skip: number;\n  take: number;\n}\n"]}
{"filename": "src/databases/activation.link.database.ts", "chunked_list": ["import DBClient from \"../../prisma/prisma.client\";\nimport { ActivationLink } from \"@prisma/client\";\n\nconst prisma = DBClient.getInstance().prisma;\n\nexport const getActivationLinkById = async (id: string) => {\n  const activationLink = await prisma.activationLink.findUnique({\n    where: { id: id },\n  });\n  return activationLink;", "  });\n  return activationLink;\n};\n\nexport const deleteActivationLinkById = async (id: string) => {\n  const activationLink = await prisma.activationLink.delete({\n    where: { id: id },\n  });\n  return activationLink;\n};", "  return activationLink;\n};\n\nexport const createActivationLink = async (activationLink: ActivationLink) => {\n  const result = await prisma.activationLink.create({\n    data: { ...activationLink },\n  });\n  return result;\n};\n", "};\n"]}
{"filename": "src/databases/forum.database.ts", "chunked_list": ["import { Forum } from '@prisma/client';\nimport DBClient from '../../prisma/prisma.client';\n\nconst prisma = DBClient.getInstance().prisma;\n\nexport const getAllForum = async () => {\n  const forums = await prisma.forum.findMany({\n    include: {\n      forumComments: true,\n      creator: {", "      forumComments: true,\n      creator: {\n        select: {\n          id: true,\n          email: false,\n          username: true,\n          name: true,\n          password: false,\n          isActive: false,\n          profilePicture: true,", "          isActive: false,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,\n        },\n      },\n    },\n  });\n  return forums;", "  });\n  return forums;\n};\n\nexport const getCountForum = async () => {\n  return await prisma.forum.count();\n};\n\nexport const getNewestForumsPagination = async (\n  skip: number,", "export const getNewestForumsPagination = async (\n  skip: number,\n  take: number,\n  forumSearch: string\n) => {\n  const forums = await prisma.forum.findMany({\n    where: {\n      OR: [\n        {\n          title: {", "        {\n          title: {\n            contains: forumSearch,\n          },\n        },\n        {\n          description: {\n            contains: forumSearch,\n          },\n        },", "          },\n        },\n      ],\n    },\n    skip: skip,\n    take: take,\n    orderBy: {\n      createdAt: 'desc',\n    },\n    include: {", "    },\n    include: {\n      forumComments: true,\n      creator: {\n        select: {\n          id: true,\n          email: true,\n          username: true,\n          name: true,\n          password: false,", "          name: true,\n          password: false,\n          isActive: true,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,\n        },\n      },\n    },", "      },\n    },\n  });\n  return forums;\n};\n\nexport const getTopForumsPagination = async (\n  skip: number,\n  take: number,\n  forumSearch: string", "  take: number,\n  forumSearch: string\n) => {\n  const forums = await prisma.forum.findMany({\n    where: {\n      OR: [\n        {\n          title: {\n            contains: forumSearch,\n          },", "            contains: forumSearch,\n          },\n        },\n        {\n          description: {\n            contains: forumSearch,\n          },\n        },\n      ],\n    },", "      ],\n    },\n    skip: skip,\n    take: take,\n    orderBy: {\n      seen: 'desc',\n    },\n    include: {\n      forumComments: true,\n      creator: {", "      forumComments: true,\n      creator: {\n        select: {\n          id: true,\n          email: true,\n          role: true,\n          username: true,\n          name: true,\n          password: false,\n          isActive: true,", "          password: false,\n          isActive: true,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,\n        },\n      },\n    },\n  });", "    },\n  });\n  return forums;\n};\n\n// export const getAllUserForum = async (userId: string) => {\n//   const forums = await prisma.forum.findMany({\n//     where: {\n//       userId: userId,\n//     },", "//       userId: userId,\n//     },\n//   });\n//   return forums;\n// };\n\nexport const getForumById = async (id: string) => {\n  const forum = await prisma.forum.findUnique({\n    where: {\n      id: id,", "    where: {\n      id: id,\n    },\n    include: {\n      _count: true,\n      creator: {\n        select: {\n          id: true,\n          email: false,\n          username: true,", "          email: false,\n          username: true,\n          name: true,\n          password: false,\n          role: true,\n          isActive: false,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,", "          activationLink: false,\n          refreshToken: false,\n        },\n      },\n      forumComments: {\n        include: {\n          _count: true,\n          forumReplies: {\n            include: {\n              replier: {", "            include: {\n              replier: {\n                select: {\n                  id: true,\n                  email: false,\n                  username: true,\n                  role: true,\n                  name: true,\n                  password: false,\n                  isActive: false,", "                  password: false,\n                  isActive: false,\n                  profilePicture: true,\n                  forums: false,\n                  activationLink: false,\n                  refreshToken: false,\n                },\n              },\n            },\n          },", "            },\n          },\n          commenter: {\n            select: {\n              id: true,\n              role: true,\n              email: false,\n              username: true,\n              name: true,\n              password: false,", "              name: true,\n              password: false,\n              isActive: false,\n              profilePicture: true,\n              forums: false,\n              activationLink: false,\n              refreshToken: false,\n            },\n          },\n        },", "          },\n        },\n      },\n      forumAttachments: true,\n    },\n  });\n  return forum;\n};\n\nexport const createForum = async (forum: Forum) => {", "\nexport const createForum = async (forum: Forum) => {\n  const result = await prisma.forum.create({\n    data: { ...forum },\n    include: {\n      creator: {\n        select: {\n          id: true,\n          email: false,\n          username: true,", "          email: false,\n          username: true,\n          name: true,\n          password: false,\n          isActive: false,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,\n        },", "          refreshToken: false,\n        },\n      },\n    },\n  });\n  return result;\n};\n\nexport const updateForum = async (\n  id: string,", "export const updateForum = async (\n  id: string,\n  title: string,\n  description: string\n) => {\n  const result = await prisma.forum.update({\n    where: {\n      id: id,\n    },\n    data: { title: title, description: description },", "    },\n    data: { title: title, description: description },\n    include: {\n      creator: {\n        select: {\n          id: true,\n          email: false,\n          username: true,\n          name: true,\n          password: false,", "          name: true,\n          password: false,\n          isActive: false,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,\n        },\n      },\n    },", "      },\n    },\n  });\n  return result;\n};\n\nexport const incrementForumSeen = async (id: string) => {\n  const forum = await prisma.forum.update({\n    where: { id: id },\n    data: { seen: { increment: 1 } },", "    where: { id: id },\n    data: { seen: { increment: 1 } },\n    include: {\n      creator: {\n        select: {\n          id: true,\n          email: false,\n          username: true,\n          name: true,\n          password: false,", "          name: true,\n          password: false,\n          isActive: false,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,\n        },\n      },\n    },", "      },\n    },\n  });\n  return forum;\n};\n\nexport const deleteForum = async (id: string) => {\n  const result = await prisma.forum.delete({\n    where: {\n      id: id,", "    where: {\n      id: id,\n    },\n    include: {\n      creator: {\n        select: {\n          id: true,\n          email: false,\n          username: true,\n          name: true,", "          username: true,\n          name: true,\n          password: false,\n          isActive: false,\n          profilePicture: true,\n          forums: false,\n          activationLink: false,\n          refreshToken: false,\n        },\n      },", "        },\n      },\n    },\n  });\n  return result;\n};\n\nexport const checkForumCreator = async (forumId: string, userId: string) => {\n  const result = await prisma.forum.findFirst({\n    where: {", "  const result = await prisma.forum.findFirst({\n    where: {\n      id: forumId,\n      userId: userId,\n    },\n  });\n  return result;\n};\n", ""]}
{"filename": "src/databases/forum.reply.database.ts", "chunked_list": ["import DBClient from \"../../prisma/prisma.client\";\nimport { ForumReply } from \"@prisma/client\";\n\nconst prisma = DBClient.getInstance().prisma;\n\nexport const getAllForumReplies = async (forumCommentId: string) => {\n  const forumReplies = await prisma.forumReply.findMany({\n    where: {\n      forumCommentId: forumCommentId,\n    },", "      forumCommentId: forumCommentId,\n    },\n    orderBy: {\n      createdAt: \"asc\",\n    },\n  });\n  return forumReplies;\n};\n\nexport const createForumReply = async (forumReply: ForumReply) => {", "\nexport const createForumReply = async (forumReply: ForumReply) => {\n  const result = await prisma.forumReply.create({\n    data: {\n      ...forumReply,\n    },\n  });\n  return result;\n};\n", "};\n"]}
{"filename": "src/databases/user.database.ts", "chunked_list": ["import { User } from '@prisma/client';\nimport DBClient from '../../prisma/prisma.client';\nimport { deleteFile } from '../facades/helper';\nimport { profilePictureRelativePath } from '../utils/constants';\n\nconst prisma = DBClient.getInstance().prisma;\n\nexport const getUserById = async (id: string) => {\n  const user = await prisma.user.findUnique({\n    where: { id: id },", "  const user = await prisma.user.findUnique({\n    where: { id: id },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,", "      profilePicture: true,\n      forums: true,\n      refreshToken: false,\n    },\n  });\n  return user;\n};\n\nexport const getUserByEmail = async (email: string) => {\n  const user = await prisma.user.findUnique({", "export const getUserByEmail = async (email: string) => {\n  const user = await prisma.user.findUnique({\n    where: { email: email },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: true,\n      role: true,", "      password: true,\n      role: true,\n      isActive: true,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;", "  });\n  return user;\n};\n\nexport const getUserByUsername = async (username: string) => {\n  const user = await prisma.user.findUnique({\n    where: { username: username },\n    select: {\n      id: true,\n      email: true,", "      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,", "      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;\n};\n\nexport const getUserByRefreshToken = async (refreshToken: string) => {\n  const user = await prisma.user.findFirst({", "export const getUserByRefreshToken = async (refreshToken: string) => {\n  const user = await prisma.user.findFirst({\n    where: { refreshToken: refreshToken },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,", "      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;", "  });\n  return user;\n};\n\nexport const isEmailExists = async (email: string): Promise<boolean> => {\n  const user = await prisma.user.findUnique({\n    where: {\n      email: email,\n    },\n  });", "    },\n  });\n  return !!user;\n};\n\nexport const isUsernameExists = async (username: string): Promise<boolean> => {\n  const user = await prisma.user.findUnique({\n    where: {\n      username: username,\n    },", "      username: username,\n    },\n  });\n  return !!user;\n};\n\nexport const createUser = async (user: User) => {\n  const result = await prisma.user.create({\n    data: { ...user },\n    select: {", "    data: { ...user },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,", "      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return result;\n};\n", "};\n\nexport const createActiveUser = async (user: User) => {\n  const result = await prisma.user.create({\n    data: { ...user },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,", "      username: true,\n      name: true,\n      password: false,\n      role: true,\n      isActive: true,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },", "      refreshToken: false,\n    },\n  });\n  return result;\n};\n\nexport const activateUser = async (id: string) => {\n  const user = await prisma.user.update({\n    where: { id: id },\n    data: {", "    where: { id: id },\n    data: {\n      isActive: true,\n    },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,", "      name: true,\n      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });", "    },\n  });\n  return user;\n};\n\nexport const updateRefreshToken = async (id: string, refreshToken: string) => {\n  const user = await prisma.user.update({\n    where: { id: id },\n    data: {\n      refreshToken: refreshToken,", "    data: {\n      refreshToken: refreshToken,\n    },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,", "      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;", "  });\n  return user;\n};\n\nexport const clearRefreshToken = async (id: string) => {\n  const user = await prisma.user.update({\n    where: { id: id },\n    data: {\n      refreshToken: '',\n    },", "      refreshToken: '',\n    },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,\n      isActive: false,", "      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;\n};", "  return user;\n};\n\nexport const updateProfile = async (\n  id: string,\n  username: string,\n  name: string\n) => {\n  const user = await prisma.user.update({\n    where: { id: id },", "  const user = await prisma.user.update({\n    where: { id: id },\n    data: {\n      username: username,\n      name: name,\n    },\n    select: {\n      id: true,\n      email: true,\n      username: true,", "      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,", "      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;\n};\n\nexport const updateProfilePicture = async (\n  id: string,\n  profilePicture: string", "  id: string,\n  profilePicture: string\n) => {\n  const prevUser = await getUserById(id);\n\n  if (prevUser) {\n    if (prevUser.profilePicture !== '') {\n      deleteFile(profilePictureRelativePath + prevUser.profilePicture);\n    }\n  }\n\n  const user = await prisma.user.update({\n    where: { id: id },\n    data: {\n      profilePicture: profilePicture,\n    },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;\n};\n\nexport const updateRoleDoctor = async (id: string) => {\n  const user = await prisma.user.update({\n    where: { id: id },\n    data: {\n      role: 'Doctor',\n    },\n    select: {\n      id: true,\n      email: true,\n      username: true,\n      name: true,\n      password: false,\n      role: true,\n      isActive: false,\n      profilePicture: true,\n      forums: true,\n      activationLink: false,\n      refreshToken: false,\n    },\n  });\n  return user;\n};\n\nexport const getAllRoles = async () => {\n  const members = await prisma.user.findMany({\n    where: {\n      role: 'Member',\n    },\n  });\n\n  const doctors = await prisma.user.findMany({\n    where: {\n      role: 'Doctor',\n    },\n  });\n\n  const admins = await prisma.user.findMany({\n    where: {\n      role: 'Admin',\n    },\n  });\n\n  return { members, doctors, admins };\n};\n"]}
{"filename": "src/databases/forum.comment.database.ts", "chunked_list": ["import DBClient from \"../../prisma/prisma.client\";\nimport { ForumComment } from \"@prisma/client\";\n\nconst prisma = DBClient.getInstance().prisma;\n\nexport const getAllForumComments = async (forumId: string) => {\n  const forumComments = await prisma.forumComment.findMany({\n    where: {\n      forumId: forumId,\n    },", "      forumId: forumId,\n    },\n    include: {\n      _count: true,\n      forumReplies: true,\n    },\n    orderBy: {\n        createdAt: \"asc\"\n    }\n  });", "    }\n  });\n  return forumComments;\n};\n\nexport const createForumComment = async (forumComment: ForumComment) => {\n  const result = await prisma.forumComment.create({\n    data: {\n      ...forumComment,\n    },", "      ...forumComment,\n    },\n  });\n  return result;\n};\n"]}
{"filename": "src/databases/forum.attachment.database.ts", "chunked_list": ["import DBClient from \"../../prisma/prisma.client\";\nimport { ForumAttachment } from \"@prisma/client\";\n\nconst prisma = DBClient.getInstance().prisma;\n\nexport const createForumAttachment = async (\n  forumAttachment: ForumAttachment\n) => {\n  const result = await prisma.forumAttachment.create({\n    data: { ...forumAttachment },", "  const result = await prisma.forumAttachment.create({\n    data: { ...forumAttachment },\n  });\n  return result;\n};\n\nexport const getAllForumAttachments = async (forumId: string) => {\n  const forumAttachments = await prisma.forumAttachment.findMany({\n    where: {\n      forumId: forumId,", "    where: {\n      forumId: forumId,\n    },\n  });\n  return forumAttachments;\n};\n"]}
{"filename": "src/middlewares/forum.middleware.ts", "chunked_list": ["import { NextFunction, Request, Response } from 'express';\nimport { checkForumCreator } from '../databases/forum.database';\n\nexport const isForumCreator = async (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    const { forumId } = req.params;\n    const userId = req.jwtPayload && req.jwtPayload.id;\n", "  try {\n    const { forumId } = req.params;\n    const userId = req.jwtPayload && req.jwtPayload.id;\n\n    if (!userId) {\n      return res.status(400).json({ errors: 'error occurred!' });\n    }\n\n    const check = await checkForumCreator(forumId, userId);\n\n    if (!check) {\n      return res.status(400).json({ errors: 'you are not the forum creator!' });\n    }\n\n    return next();", "    if (!check) {\n      return res.status(400).json({ errors: 'you are not the forum creator!' });\n    }\n\n    return next();\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n"]}
{"filename": "src/middlewares/role.middleware.ts", "chunked_list": ["import { NextFunction, Request, Response } from \"express\";\n\nexport const isMember = (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const role: string = req.jwtPayload ? req.jwtPayload.role : '';\n\n    if (!role) {\n      return res.status(400).json({ errors: [\"error occurred!\"] });\n    }\n\n    if (role === \"Member\") {\n      return next();\n    }\n\n    return res.status(400).json({ errors: [\"your role is not member!\"] });", "    if (role === \"Member\") {\n      return next();\n    }\n\n    return res.status(400).json({ errors: [\"your role is not member!\"] });\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: [\"error occurred!\"] });\n  }\n};\n\nexport const isDoctor = (req: Request, res: Response, next: NextFunction) => {", "  try {\n    // console.log(req.jwtPayload)\n    const role: string = req.jwtPayload ? req.jwtPayload.role : '';\n\n    if (!role) {\n      return res.status(400).json({ errors: [\"error occurred!\"] });\n    }\n\n    if (role === \"Doctor\") {\n      return next();\n    }\n\n    return res.status(400).json({ errors: [\"your role is not doctor!\"] });", "    if (role === \"Doctor\") {\n      return next();\n    }\n\n    return res.status(400).json({ errors: [\"your role is not doctor!\"] });\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: [\"error occurred!\"] });\n  }\n};\n\nexport const isAdmin = (req: Request, res: Response, next: NextFunction) => {", "  try {\n    const role: string = req.jwtPayload ? req.jwtPayload.role : '';\n\n    if (!role) {\n      return res.status(400).json({ errors: [\"error occurred!\"] });\n    }\n\n    if (role === \"Admin\") {\n      return next();\n    }\n\n    return res.status(400).json({ errors: [\"your role is not admin!\"] });", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: [\"error occurred!\"] });\n  }\n};\n"]}
{"filename": "src/middlewares/file.upload.middleware.ts", "chunked_list": ["import { NextFunction, Request, Response } from \"express\";\nimport multer, { FileFilterCallback } from \"multer\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { getFileExtension } from \"../facades/helper\";\nimport {\n  forumRelativePath,\n  maxForumAttachmentCount,\n  profilePictureRelativePath,\n} from \"../utils/constants\";\n\ntype DestinationCallback = (error: Error | null, destination: string) => void;", "} from \"../utils/constants\";\n\ntype DestinationCallback = (error: Error | null, destination: string) => void;\ntype FileNameCallback = (error: Error | null, filename: string) => void;\n\nconst profilePictureStorage = multer.diskStorage({\n  destination: (\n    _req: Request,\n    _file: Express.Multer.File,\n    callback: DestinationCallback\n  ): void => {\n    callback(null, profilePictureRelativePath);\n  },\n  filename: (\n    req: Request,\n    file: Express.Multer.File,\n    callback: FileNameCallback\n  ): void => {\n    const fileName = uuidv4() + getFileExtension(file.originalname);\n    req.body.profilePicture = fileName;\n    callback(null, fileName);\n  },\n});\n\nconst profilePictureFileFilter = (\n  req: Request,\n  file: Express.Multer.File,\n  callback: FileFilterCallback\n): void => {", "  if (\n    file.mimetype === \"image/png\" ||\n    file.mimetype === \"image/jpg\" ||\n    file.mimetype === \"image/jpeg\"\n  ) {\n    callback(null, true);\n  } else {\n    req.fileValidationError =\n      \"invalid file type. Only PNG, JPG, and JPEG files are allowed!\";\n    callback(null, false);\n  }\n};\n\nconst forumStorage = multer.diskStorage({\n  destination: (\n    _req: Request,\n    _file: Express.Multer.File,\n    callback: DestinationCallback\n  ): void => {\n    callback(null, forumRelativePath);\n  },\n  filename: (\n    _req: Request,\n    file: Express.Multer.File,\n    callback: FileNameCallback\n  ): void => {\n    const fileName = uuidv4() + getFileExtension(file.originalname);\n    file.originalname = fileName;\n    callback(null, fileName);\n  },\n});\n\nconst forumFileFilter = (\n  req: Request,\n  file: Express.Multer.File,\n  callback: FileFilterCallback\n): void => {", "  if (\n    file.mimetype === \"image/png\" ||\n    file.mimetype === \"image/jpg\" ||\n    file.mimetype === \"image/jpeg\" ||\n    file.mimetype === \"video/mp4\" ||\n    file.mimetype === \"video/quicktime\" ||\n    file.mimetype === \"video/x-matroska\"\n  ) {\n    callback(null, true);\n  } else {\n    req.fileValidationError = \"invalid file type!\";\n    callback(null, false);\n  }\n};\n\nexport const uploadProfilePicture = (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  multer({\n    storage: profilePictureStorage,\n    fileFilter: profilePictureFileFilter,\n  }).single(\"profilePicture\")(req, res, (err) => {", "    if (err instanceof multer.MulterError) {\n      return res\n        .status(500)\n        .json({ message: \"An error occurred while uploading files\" });\n    } else if (err) {\n      return res\n        .status(500)\n        .json({ message: \"An error occurred while uploading files\" });\n    }\n    return next();\n  });\n};\n\nexport const uploadForum = (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  multer({\n    storage: forumStorage,\n    fileFilter: forumFileFilter,\n  }).array(\"forumAttachments\", maxForumAttachmentCount)(req, res, (err) => {", "    if (err instanceof multer.MulterError) {\n      if (err.code === \"LIMIT_UNEXPECTED_FILE\") {\n        return res.status(400).json({ message: \"Too many files uploaded\" });\n      }\n      return res\n        .status(500)\n        .json({ message: \"An error occurred while uploading files\" });\n    } else if (err) {\n      return res\n        .status(500)\n        .json({ message: \"An error occurred while uploading files\" });\n    }\n    return next();\n  });\n};\n"]}
{"filename": "src/middlewares/validator.middleware.ts", "chunked_list": ["import { NextFunction, Request, Response } from \"express\";\nimport {\n  body,\n  cookie,\n  validationResult,\n  param,\n  query,\n} from \"express-validator\";\n\nexport const bodyEmptyValidation = (requests: string[]) => {", "\nexport const bodyEmptyValidation = (requests: string[]) => {\n  return requests.map((req) => {\n    return body(req, `${req} field cannot be empty!`).notEmpty();\n  });\n};\n\nexport const bodyEmailValidation = (requests: string[]) => {\n  return requests.map((req) => {\n    return body(", "  return requests.map((req) => {\n    return body(\n      req,\n      `${req} field must be in the correct email format!`\n    ).isEmail();\n  });\n};\n\nexport const bodyUUIDValidation = (requests: string[]) => {\n  return requests.map((req) => {", "export const bodyUUIDValidation = (requests: string[]) => {\n  return requests.map((req) => {\n    return body(\n      req,\n      `${req} body must be in the correct uuid(v4) format!`\n    ).isUUID(4);\n  });\n};\n\nexport const bodyLengthValidation = (", "\nexport const bodyLengthValidation = (\n  requests: string[],\n  min: number[],\n  max: number[]\n) => {\n  return requests.map((req, i) => {\n    return body(\n      req,\n      `${req} field must between ${min[i]} and ${max[i]} character(s)!`", "      req,\n      `${req} field must between ${min[i]} and ${max[i]} character(s)!`\n    ).isLength({ min: min[i], max: max[i] });\n  });\n};\n\nexport const queryEmptyValidation = (requests: string[]) => {\n  return requests.map((req) => {\n    return query(req, `${req} query not found`).notEmpty();\n  });", "    return query(req, `${req} query not found`).notEmpty();\n  });\n};\n\nexport const cookieEmptyValidation = (requests: string[]) => {\n  return requests.map((req) => {\n    return cookie(req, `${req} cookie not found!`).exists();\n  });\n};\n", "};\n\nexport const paramEmptyValidation = (requests: string[]) => {\n  return requests.map((req) => {\n    return param(\n      req,\n      `${req} param must be in the correct uuid(v4) format!`\n    ).notEmpty();\n  });\n};", "  });\n};\n\nexport const paramUUIDValidation = (requests: string[]) => {\n  return requests.map((req) => {\n    return param(\n      req,\n      `${req} param must be in the correct uuid(v4) format!`\n    ).isUUID(4);\n  });", "    ).isUUID(4);\n  });\n};\n\nexport const errorValidator = (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  const errors = validationResult(req);\n  if (errors.isEmpty()) {\n    return next();\n  }\n  return res.status(422).json({\n    errors: errors.array().map((err) => {\n      return err.msg;\n    }),\n  });\n};\n", ") => {\n  const errors = validationResult(req);\n  if (errors.isEmpty()) {\n    return next();\n  }\n  return res.status(422).json({\n    errors: errors.array().map((err) => {\n      return err.msg;\n    }),\n  });\n};\n"]}
{"filename": "src/middlewares/auth.middleware.ts", "chunked_list": ["import { NextFunction, Request, Response } from \"express\";\nimport jwt, { Jwt, JwtPayload, VerifyErrors } from \"jsonwebtoken\";\nimport { accessTokenSecret } from \"../utils/constants\";\n\nexport const isAuthenticated = (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    const authHeader = req.headers[\"authorization\"];\n    const token = authHeader && authHeader.split(\" \")[1];\n", ") => {\n  try {\n    const authHeader = req.headers[\"authorization\"];\n    const token = authHeader && authHeader.split(\" \")[1];\n\n    if (!token) {\n      return res.status(401).json({ errors: [\"token not found!\"] });\n    }\n    jwt.verify(\n      token,\n      accessTokenSecret,\n      (\n        err: VerifyErrors | null,\n        decode: Jwt | JwtPayload | string | undefined\n      ) => {", "        if (err) {\n          return res.status(400).json({ errors: [err.message] });\n        }\n        if (decode) {\n          req.jwtPayload = decode;\n          return next();\n        }\n      }\n    );\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: [\"error occurred!\"] });\n  }\n};\n", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: [\"error occurred!\"] });\n  }\n};\n"]}
{"filename": "src/controllers/auth.controller.ts", "chunked_list": ["import { User } from '@prisma/client';\nimport axios from 'axios';\nimport { compare, hash } from 'bcrypt';\nimport { Request, Response } from 'express';\nimport jwt, { Jwt, JwtPayload, VerifyErrors } from 'jsonwebtoken';\nimport { v4 as uuidv4 } from 'uuid';\nimport { createActivationLink } from '../databases/activation.link.database';\nimport {\n  clearRefreshToken,\n  createActiveUser,", "  clearRefreshToken,\n  createActiveUser,\n  createUser,\n  getUserByEmail,\n  getUserByRefreshToken,\n  getUserByUsername,\n  updateRefreshToken,\n} from '../databases/user.database';\nimport { generateRandomString, sendEmail } from '../facades/helper';\nimport { accessTokenSecret, refreshTokenSecret } from '../utils/constants';", "import { generateRandomString, sendEmail } from '../facades/helper';\nimport { accessTokenSecret, refreshTokenSecret } from '../utils/constants';\n\nexport const login = async (req: Request, res: Response) => {\n  try {\n    const { email, password } = req.body;\n    const user = await getUserByEmail(email);\n    if (!user) {\n      return res.status(400).json({ errors: ['email not found!'] });\n    }\n    const match = await compare(password, user.password);", "    if (!match) {\n      return res.status(403).json({ errors: ['wrong credentials!'] });\n    }\n    if (!user.isActive) {\n      return res\n        .status(403)\n        .json({ errors: ['please verify your account before proceeding!'] });\n    }\n\n    const accessToken = jwt.sign(\n      { id: user.id, email: user.email, role: user.role },\n      accessTokenSecret,\n      {\n        expiresIn: '7d',\n      }\n    );\n\n    const refreshToken = jwt.sign(\n      { id: user.id, email: user.email, role: user.role },\n      refreshTokenSecret,\n      {\n        expiresIn: '1d',\n      }\n    );\n\n    const user2 = await updateRefreshToken(user.id, refreshToken);\n\n    return res\n      .cookie('refreshToken', refreshToken, {\n        httpOnly: true,\n        sameSite: 'none',\n        secure: false,\n        maxAge: 24 * 60 * 60 * 1000,\n      })\n      .status(200)\n      .json({ user: user2, accessToken: accessToken });", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const loginGoogleToken = async (req: Request, res: Response) => {\n  try {\n    const { token } = req.body;\n    const response = await axios.get(\n      `https://oauth2.googleapis.com/tokeninfo?id_token=${token}`\n    );", "    if (response.status === 400) {\n      return res.status(400).json({ errors: ['token not found!'] });\n    }\n    const user = await getUserByEmail(response.data.email);\n    if (user) {\n      const accessToken = jwt.sign(\n        { id: user.id, email: user.email, role: user.role },\n        accessTokenSecret,\n        {\n          expiresIn: '7d',\n        }\n      );\n\n      const refreshToken = jwt.sign(\n        { id: user.id, email: user.email, role: user.role },\n        refreshTokenSecret,\n        {\n          expiresIn: '1d',\n        }\n      );\n      const user2 = await updateRefreshToken(user.id, refreshToken);\n      return res\n        .cookie('refreshToken', refreshToken, {\n          httpOnly: true,\n          maxAge: 24 * 60 * 60 * 1000,\n        })\n        .status(200)\n        .json({ user: user2, accessToken: accessToken });\n    } else {\n      const user: User = {\n        email: response.data.email,\n        name: response.data.name,\n        profilePicture: response.data.picture,\n        role: 'Member',\n        id: uuidv4(),\n        username: generateRandomString('profile'),\n        refreshToken: '',\n        isActive: true,\n        password: '',\n      };\n      await createActiveUser(user);\n      const accessToken = jwt.sign(\n        { id: user.id, email: user.email, role: user.role },\n        accessTokenSecret,\n        {\n          expiresIn: '7d',\n        }\n      );\n\n      const refreshToken = jwt.sign(\n        { id: user.id, email: user.email, role: user.role },\n        refreshTokenSecret,\n        {\n          expiresIn: '1d',\n        }\n      );\n      const user2 = await updateRefreshToken(user.id, refreshToken);\n      return res\n        .cookie('refreshToken', refreshToken, {\n          httpOnly: true,\n          maxAge: 24 * 60 * 60 * 1000,\n        })\n        .status(200)\n        .json({ user: user2, accessToken: accessToken });\n    }", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const register = async (req: Request, res: Response) => {\n  try {\n    const { email, name, username, password } = req.body;\n\n    const validateEmail = await getUserByEmail(email);\n    const validateUsername = await getUserByUsername(username);\n", "    if (validateEmail) {\n      return res.status(400).json({ errors: ['email you provided is taken!'] });\n    }\n\n    if (validateUsername) {\n      return res\n        .status(400)\n        .json({ errors: ['username you provided is taken!'] });\n    }\n\n    const saltRounds = 10;\n    const hashedPassword = await hash(password, saltRounds);\n\n    const user = await createUser({\n      id: uuidv4(),\n      email: email,\n      username: username,\n      name: name,\n      password: hashedPassword,\n      role: 'Member',\n      isActive: false,\n      profilePicture: '/profile.webp',\n      refreshToken: '',\n    });\n\n    const activationLink = await createActivationLink({\n      id: uuidv4(),\n      userId: user.id,\n      expirationDate: new Date(Date.now() + 3600 * 1000 * 2),\n    });\n\n    await sendEmail(email, activationLink.id);\n\n    return res.status(200).json({ user: user });", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const refreshToken = async (req: Request, res: Response) => {\n  try {\n    const refreshToken = req.cookies.refreshToken;\n\n    const user = await getUserByRefreshToken(refreshToken);\n", "    if (!user) {\n      return res.status(403).json({ errors: ['user not found!'] });\n    }\n\n    jwt.verify(\n      refreshToken,\n      refreshTokenSecret,\n      (\n        err: VerifyErrors | null,\n        decode: Jwt | JwtPayload | string | undefined\n      ) => {", "        if (err) {\n          return res.status(400).json({ errors: [err.message] });\n        }\n        if (decode) {\n          const accessToken = jwt.sign(\n            { id: user.id, email: user.email, role: user.role },\n            accessTokenSecret,\n            {\n              expiresIn: '7d',\n            }\n          );\n          res.status(200).json({ accessToken: accessToken });\n        }\n      }\n    );", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const logout = async (req: Request, res: Response) => {\n  try {\n    const refreshToken = req.cookies.refreshToken;\n\n    const user = await getUserByRefreshToken(refreshToken);\n", "    if (!user) {\n      return res.status(403).json({ errors: ['user not found!'] });\n    }\n\n    await clearRefreshToken(user.id);\n\n    return res\n      .status(200)\n      .clearCookie('refreshToken')\n      .json({ successes: ['logout successful!'] });\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n"]}
{"filename": "src/controllers/user.controller.ts", "chunked_list": ["import { Request, Response } from 'express';\nimport {\n  getAllRoles,\n  getUserById as getUser,\n  getUserByUsername,\n  updateProfile as uProfile,\n  updateProfilePicture as uProfilePicture,\n  updateRoleDoctor,\n} from '../databases/user.database';\n", "} from '../databases/user.database';\n\nexport const getUserById = async (req: Request, res: Response) => {};\n\nexport const refetch = async (req: Request, res: Response) => {\n  try {\n    const id = req.jwtPayload && req.jwtPayload.id;\n    const user = await getUser(id);\n    if (user) {\n      const data = {\n        user,\n      };\n      return res.status(200).json(user);\n    }\n    return res.status(400).json({ errors: ['user not found'] });", "    if (user) {\n      const data = {\n        user,\n      };\n      return res.status(200).json(user);\n    }\n    return res.status(400).json({ errors: ['user not found'] });\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const updateProfilePicture = async (req: Request, res: Response) => {", "  try {\n    if (req.fileValidationError) {\n      return res.status(400).json({ errors: [req.fileValidationError] });\n    }\n\n    const { profilePicture } = req.body;\n\n    const userId = req.jwtPayload && req.jwtPayload.id;\n\n    const user = await uProfilePicture(userId, profilePicture);\n", "    if (user) {\n      return res.status(200).json(user);\n    }\n\n    return res.status(400).json({ errors: ['user not found!'] });\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const updateProfile = async (req: Request, res: Response) => {", "  try {\n    const { username, name } = req.body;\n\n    const userId = req.jwtPayload && req.jwtPayload.id;\n\n    const checkUsername = await getUserByUsername(username);\n\n    if (checkUsername) {\n      res.status(400).json({ errors: ['username already taken!'] });\n    }\n\n    const user = await uProfile(userId, username, name);\n", "    if (!user) {\n      return res.status(400).json({ errors: ['user not found!'] });\n    }\n\n    return res.status(200).json({ user: user });\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const changeRole = async (req: Request, res: Response) => {", "  try {\n    const { userId } = req.body;\n\n    const user = await updateRoleDoctor(userId);\n\n    if (!user) {\n      res.status(400).json({ errors: ['user not found!'] });\n    }\n\n    return res.status(200).json({ user: user });\n  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const adminPage = async (req: Request, res: Response) => {", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n\nexport const adminPage = async (req: Request, res: Response) => {\n  try {\n    const { members, doctors, admins } = await getAllRoles();\n\n    return res\n      .status(200)\n      .json({ members: members, doctors: doctors, admins: admins });", "  } catch (error) {\n    console.log(error);\n    return res.status(400).json({ errors: ['error occurred!'] });\n  }\n};\n"]}
{"filename": "src/controllers/forum.reply.controller.ts", "chunked_list": ["import { Request, Response } from \"express\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport {\n  createForumReply as cForumReply,\n  getAllForumReplies as gAllForumReplies,\n} from \"../databases/forum.reply.database\";\n\nexport const createForumReplies = async (req: Request, res: Response) => {\n  try {\n    const { forumCommentId, reply } = req.body;\n\n    const userId = req.jwtPayload && req.jwtPayload.id;\n\n    const forumReply = await cForumReply({\n      id: uuidv4(),\n      reply: reply,\n      forumCommentId: forumCommentId,\n      userId: userId,\n      createdAt: new Date(Date.now()),\n    });\n", "  try {\n    const { forumCommentId, reply } = req.body;\n\n    const userId = req.jwtPayload && req.jwtPayload.id;\n\n    const forumReply = await cForumReply({\n      id: uuidv4(),\n      reply: reply,\n      forumCommentId: forumCommentId,\n      userId: userId,\n      createdAt: new Date(Date.now()),\n    });\n", "    if (!forumReply) {\n      return res.status(400).json({ errors: [\"forum reply cannot be made!\"] });\n    }\n\n    return res.status(200).json({ successes: [\"reply has been added!\"] });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: [\"error occurred\"] });\n  }\n};\n\nexport const getAllForumReplies = async (req: Request, res: Response) => {", "  try {\n    const { forumCommentId } = req.params;\n\n    const forumReplies = await gAllForumReplies(forumCommentId);\n    return res.status(200).json({ forumReplies: forumReplies });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: [\"error occurred\"] });\n  }\n};\n"]}
{"filename": "src/controllers/forum.controller.ts", "chunked_list": ["import { ForumAttachmentType } from '@prisma/client';\nimport { Request, Response } from 'express';\nimport { v4 as uuidv4 } from 'uuid';\nimport {\n  createForumAttachment,\n  getAllForumAttachments,\n} from '../databases/forum.attachment.database';\nimport {\n  createForum as cForum,\n  deleteForum as dForum,", "  createForum as cForum,\n  deleteForum as dForum,\n  getAllForum,\n  getCountForum,\n  getForumById,\n  getNewestForumsPagination,\n  getTopForumsPagination,\n  incrementForumSeen,\n  updateForum as uForum,\n} from '../databases/forum.database';", "  updateForum as uForum,\n} from '../databases/forum.database';\nimport { getPaginationOptions } from '../facades/helper';\nimport { PaginationOptions } from '../interfaces/interface';\nimport { forumPerPage } from '../utils/constants';\n\nexport const getForum = async (req: Request, res: Response) => {\n  try {\n    const { forumId } = req.params;\n\n    const forum = await getForumById(forumId);\n", "    if (!forum) {\n      res.status(404).json({ errors: ['forum not found!'] });\n    }\n\n    res.status(200).json({ forum: forum });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const newestForumPagination = async (req: Request, res: Response) => {", "  try {\n    const { page } = req.query;\n    let { search } = req.query;\n\n    if (search === undefined || search === null) {\n      search = '';\n    }\n    search = search?.toString();\n\n    let p: number = 1;\n    if (typeof page == 'string' && !isNaN(parseInt(page))) {\n      p = parseInt(page);\n    }\n\n    const paginationOptions: PaginationOptions = getPaginationOptions(\n      p,\n      forumPerPage\n    );\n\n    const forums = await getNewestForumsPagination(\n      paginationOptions.skip,\n      paginationOptions.take,\n      search\n    );\n\n    const totalForums = await getCountForum();\n\n    res.status(200).json({\n      forums: forums,\n      totalForums: totalForums,\n      perPage: forumPerPage,\n    });", "    if (typeof page == 'string' && !isNaN(parseInt(page))) {\n      p = parseInt(page);\n    }\n\n    const paginationOptions: PaginationOptions = getPaginationOptions(\n      p,\n      forumPerPage\n    );\n\n    const forums = await getNewestForumsPagination(\n      paginationOptions.skip,\n      paginationOptions.take,\n      search\n    );\n\n    const totalForums = await getCountForum();\n\n    res.status(200).json({\n      forums: forums,\n      totalForums: totalForums,\n      perPage: forumPerPage,\n    });", "  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const getAll = async (req: Request, res: Response) => {\n  try {\n    const forums = await getAllForum();\n\n    res.status(200).json({\n      forums: forums,\n    });", "  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const topForumPagination = async (req: Request, res: Response) => {\n  try {\n    const { page } = req.query;\n    let { search } = req.query;\n", "    if (search === undefined || search === null) {\n      search = '';\n    }\n    search = search?.toString();\n\n    let p: number = 1;\n    if (typeof page == 'string' && !isNaN(parseInt(page))) {\n      p = parseInt(page);\n    }\n\n    const paginationOptions: PaginationOptions = getPaginationOptions(\n      p,\n      forumPerPage\n    );\n\n    const forums = await getTopForumsPagination(\n      paginationOptions.skip,\n      paginationOptions.take,\n      search\n    );\n\n    const totalForums = await getCountForum();\n\n    res.status(200).json({\n      forums: forums,\n      totalForums: totalForums,\n      perPage: forumPerPage,\n    });", "  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const createForum = async (req: Request, res: Response) => {\n  try {\n    if (req.fileValidationError) {\n      return res.status(400).json({ errors: [req.fileValidationError] });\n    }\n\n    const { title, description } = req.body;\n\n    const userId = req.jwtPayload && req.jwtPayload.id;\n\n    const forum = await cForum({\n      id: uuidv4(),\n      title: title,\n      description: description,\n      userId: userId,\n      seen: 0,\n      createdAt: new Date(Date.now()),\n      updatedAt: new Date(Date.now()),\n    });\n", "    if (req.fileValidationError) {\n      return res.status(400).json({ errors: [req.fileValidationError] });\n    }\n\n    const { title, description } = req.body;\n\n    const userId = req.jwtPayload && req.jwtPayload.id;\n\n    const forum = await cForum({\n      id: uuidv4(),\n      title: title,\n      description: description,\n      userId: userId,\n      seen: 0,\n      createdAt: new Date(Date.now()),\n      updatedAt: new Date(Date.now()),\n    });\n", "    if (!forum) {\n      return res.status(400).json({ errors: ['forum cannot be made!'] });\n    }\n\n    if (req.files && !(req.files instanceof Array)) {\n      // Validate file must be array\n      return res.status(400).json({ errors: ['file must be array'] });\n    }\n\n    const files = req.files;\n    if (files) {\n      // Validate if there's file in the form than create the attachment\n      const length = files.length;", "    if (files) {\n      // Validate if there's file in the form than create the attachment\n      const length = files.length;\n      for (let index = 0; index < length; index++) {\n        const file = files.at(index);\n        var type: ForumAttachmentType = 'Video';\n        if (!file) {\n          return res.status(400).json({ errors: ['error occurred'] });\n        }\n        if (\n          file.mimetype === 'image/png' ||\n          file.mimetype === 'image/jpg' ||\n          file.mimetype === 'image/jpeg'\n        ) {\n          type = 'Image';\n        }\n        await createForumAttachment({\n          path: file.originalname,\n          forumId: forum.id,\n          type: type,\n        });\n      }\n    }\n\n    const forumAttachments = await getAllForumAttachments(forum.id);\n\n    return res\n      .status(200)\n      .json({ forum: forum, forumAttachments: forumAttachments });", "        if (\n          file.mimetype === 'image/png' ||\n          file.mimetype === 'image/jpg' ||\n          file.mimetype === 'image/jpeg'\n        ) {\n          type = 'Image';\n        }\n        await createForumAttachment({\n          path: file.originalname,\n          forumId: forum.id,\n          type: type,\n        });\n      }\n    }\n\n    const forumAttachments = await getAllForumAttachments(forum.id);\n\n    return res\n      .status(200)\n      .json({ forum: forum, forumAttachments: forumAttachments });", "  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const forumSeen = async (req: Request, res: Response) => {\n  try {\n    const { forumId } = req.body;\n    const forum = await incrementForumSeen(forumId);\n", "    if (!forum) {\n      return res.status(400).json({ errors: ['forum not found'] });\n    }\n\n    return res.status(200).json({ forum: forum });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const updateForum = async (req: Request, res: Response) => {", "  try {\n    const { forumId, title, description } = req.body;\n\n    const forum = await uForum(forumId, title, description);\n\n    if (!forum) {\n      return res.status(400).json({ errors: ['forum not found'] });\n    }\n\n    return res.status(200).json({ forum: forum });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const deleteForum = async (req: Request, res: Response) => {", "  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n\nexport const deleteForum = async (req: Request, res: Response) => {\n  try {\n    const { forumId } = req.body;\n\n    const forum = await dForum(forumId);\n", "    if (!forum) {\n      return res.status(400).json({ errors: ['forum not found'] });\n    }\n    return res.status(200).json({ successes: ['forum successfully deleted!'] });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: ['error occurred'] });\n  }\n};\n"]}
{"filename": "src/controllers/forum.comment.controller.ts", "chunked_list": ["import { Request, Response } from \"express\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport {\n  createForumComment as cForumComment,\n  getAllForumComments as gAllForumComments,\n} from \"../databases/forum.comment.database\";\n\nexport const createForumComment = async (req: Request, res: Response) => {\n  try {\n    const { forumId, comment } = req.body;\n    console.log('1')\n    const userId = req.jwtPayload && req.jwtPayload.id;\n    console.log('2')\n    \n    const forumComment = await cForumComment({\n      id: uuidv4(),\n      comment: comment,\n      forumId: forumId,\n      userId: userId,\n      createdAt: new Date(Date.now()),\n    });\n    \n    console.log('3')", "  try {\n    const { forumId, comment } = req.body;\n    console.log('1')\n    const userId = req.jwtPayload && req.jwtPayload.id;\n    console.log('2')\n    \n    const forumComment = await cForumComment({\n      id: uuidv4(),\n      comment: comment,\n      forumId: forumId,\n      userId: userId,\n      createdAt: new Date(Date.now()),\n    });\n    \n    console.log('3')", "    if (!forumComment) {\n      return res\n      .status(400)\n      .json({ errors: [\"forum comment cannot be made!\"] });\n    }\n    console.log('4')\n    \n    return res.status(200).json({ successes: [\"comment has been added!\"] });\n  } catch (error) {\n    console.log('5')\n    console.log(error);\n    res.status(400).json({ errors: [\"error occurred\"] });\n  }\n};\n\nexport const getAllForumComments = async (req: Request, res: Response) => {", "  } catch (error) {\n    console.log('5')\n    console.log(error);\n    res.status(400).json({ errors: [\"error occurred\"] });\n  }\n};\n\nexport const getAllForumComments = async (req: Request, res: Response) => {\n  try {\n    const { forumId } = req.params;\n\n    const forumComments = await gAllForumComments(forumId);\n    return res.status(200).json({ forumComments: forumComments });", "  try {\n    const { forumId } = req.params;\n\n    const forumComments = await gAllForumComments(forumId);\n    return res.status(200).json({ forumComments: forumComments });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: [\"error occurred\"] });\n  }\n};\n"]}
{"filename": "src/controllers/activation.link.controller.ts", "chunked_list": ["import { Request, Response } from \"express\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport {\n  createActivationLink,\n  deleteActivationLinkById,\n  getActivationLinkById,\n} from \"../databases/activation.link.database\";\nimport { activateUser as aUser, getUserById } from \"../databases/user.database\";\nimport { sendEmail } from \"../facades/helper\";\n", "import { sendEmail } from \"../facades/helper\";\n\nexport const activateUser = async (req: Request, res: Response) => {\n  try {\n    const { activationLinkId } = req.body;\n\n    const activationLink = await getActivationLinkById(activationLinkId);\n\n    if (!activationLink) {\n      return res.status(404).json({ errors: [\"activation link not found!\"] });\n    }\n", "    if (!activationLink) {\n      return res.status(404).json({ errors: [\"activation link not found!\"] });\n    }\n\n    if (Date.now() > activationLink.expirationDate.getTime()) {\n      return res.status(410).json({ errors: [\"activation link expired!\"] });\n    }\n\n    if (await aUser(activationLink.userId)) {\n      await deleteActivationLinkById(activationLink.id);\n    }\n    return res\n      .status(200)\n      .json({ successes: [\"user activated successfully!\"] });", "    if (await aUser(activationLink.userId)) {\n      await deleteActivationLinkById(activationLink.id);\n    }\n    return res\n      .status(200)\n      .json({ successes: [\"user activated successfully!\"] });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: [\"error occurred!\"] });\n  }\n};\n\nexport const generateActivationLink = async (req: Request, res: Response) => {", "  try {\n    const { userId, activationLinkId } = req.body;\n    const user = await getUserById(userId);\n\n    if (!user) {\n      return res.status(404).json({ errors: [\"user not found!\"] });\n    }\n\n    const activationLink = await createActivationLink({\n      id: uuidv4(),\n      userId: user.id,\n      expirationDate: new Date(Date.now() + 3600 * 1000 * 2),\n    });\n", "    if (activationLink && (await sendEmail(user.email, activationLink.id))) {\n      await deleteActivationLinkById(activationLinkId);\n    }\n\n    return res.status(200).json({ successes: [\"email sent successfully!\"] });\n  } catch (error) {\n    console.log(error);\n    res.status(400).json({ errors: [\"error occurred!\"] });\n  }\n};\n"]}
{"filename": "src/routes/forum.reply.route.ts", "chunked_list": ["import { Router } from \"express\";\nimport * as forumReplyController from \"../controllers/forum.reply.controller\";\nimport {\n  bodyEmptyValidation,\n  errorValidator,\n  paramEmptyValidation,\n  paramUUIDValidation,\n} from \"../middlewares/validator.middleware\";\nimport { isDoctor } from \"../middlewares/role.middleware\";\n", "import { isDoctor } from \"../middlewares/role.middleware\";\n\nconst router = Router();\nrouter.get(\n  \"/:forumCommentId\",\n  paramEmptyValidation([\"forumCommentId\"]),\n  paramUUIDValidation([\"forumCommentId\"]),\n  errorValidator,\n  forumReplyController.getAllForumReplies\n);", "  forumReplyController.getAllForumReplies\n);\n\nrouter.post(\n  \"/create\",\n  isDoctor,\n  bodyEmptyValidation([\"forumCommentId\", \"reply\"]),\n  errorValidator,\n  forumReplyController.createForumReplies\n);", "  forumReplyController.createForumReplies\n);\n\nexport default router;\n"]}
{"filename": "src/routes/user.route.ts", "chunked_list": ["import { Router } from \"express\";\nimport * as userController from \"../controllers/user.controller\";\nimport { uploadProfilePicture } from \"../middlewares/file.upload.middleware\";\nimport { isAdmin } from \"../middlewares/role.middleware\";\nimport {\n  bodyEmptyValidation,\n  errorValidator,\n  paramEmptyValidation,\n  paramUUIDValidation,\n} from \"../middlewares/validator.middleware\";", "  paramUUIDValidation,\n} from \"../middlewares/validator.middleware\";\n\nconst router = Router();\n\nrouter.get(\n  \"/get/:id\",\n  paramEmptyValidation([\"id\"]),\n  paramUUIDValidation([\"id\"]),\n  errorValidator,", "  paramUUIDValidation([\"id\"]),\n  errorValidator,\n  userController.getUserById\n);\n\nrouter.patch(\n  \"/update-profile\",\n  bodyEmptyValidation([\"username\", \"name\"]),\n  errorValidator,\n  userController.updateProfile", "  errorValidator,\n  userController.updateProfile\n);\n\nrouter.get(\n  \"/fetch\",\n  userController.refetch\n)\n\nrouter.patch(", "\nrouter.patch(\n  \"/update-profile-picture\",\n  uploadProfilePicture,\n  bodyEmptyValidation([\"profilePicture\"]),\n  errorValidator,\n  userController.updateProfilePicture\n);\n\nrouter.patch(", "\nrouter.patch(\n  \"/change-role-doctor\",\n  isAdmin,\n  bodyEmptyValidation([\"userId\"]),\n  errorValidator,\n  userController.changeRole\n);\n\nrouter.get(\"/admin-page\", isAdmin, userController.adminPage);", "\nrouter.get(\"/admin-page\", isAdmin, userController.adminPage);\n\nexport default router;\n"]}
{"filename": "src/routes/forum.comment.route.ts", "chunked_list": ["import { Router } from \"express\";\nimport * as forumCommentController from \"../controllers/forum.comment.controller\";\nimport { isAuthenticated } from \"../middlewares/auth.middleware\";\nimport { isDoctor } from \"../middlewares/role.middleware\";\nimport {\n  bodyEmptyValidation,\n  errorValidator,\n  paramEmptyValidation,\n  paramUUIDValidation,\n} from \"../middlewares/validator.middleware\";", "  paramUUIDValidation,\n} from \"../middlewares/validator.middleware\";\n\nconst router = Router();\n\nrouter.get(\n  \"/:forumId\",\n  paramEmptyValidation([\"forumId\"]),\n  paramUUIDValidation([\"forumId\"]),\n  errorValidator,", "  paramUUIDValidation([\"forumId\"]),\n  errorValidator,\n  forumCommentController.getAllForumComments\n);\n\nrouter.post(\n  \"/create\",\n  isAuthenticated,\n  isDoctor,\n  bodyEmptyValidation([\"forumId\", \"comment\"]),", "  isDoctor,\n  bodyEmptyValidation([\"forumId\", \"comment\"]),\n  errorValidator,\n  forumCommentController.createForumComment\n);\n\nexport default router;\n"]}
{"filename": "src/routes/forum.route.ts", "chunked_list": ["import { Router } from 'express';\nimport * as forumController from '../controllers/forum.controller';\nimport { isAuthenticated } from '../middlewares/auth.middleware';\nimport { uploadForum } from '../middlewares/file.upload.middleware';\nimport { isForumCreator } from '../middlewares/forum.middleware';\nimport { isAdmin } from '../middlewares/role.middleware';\nimport {\n  bodyEmptyValidation,\n  bodyUUIDValidation,\n  errorValidator,", "  bodyUUIDValidation,\n  errorValidator,\n  paramEmptyValidation,\n  paramUUIDValidation,\n} from '../middlewares/validator.middleware';\n\nconst router = Router();\n\nrouter.get('/newest', forumController.newestForumPagination);\nrouter.get('/top', forumController.topForumPagination);", "router.get('/newest', forumController.newestForumPagination);\nrouter.get('/top', forumController.topForumPagination);\n\nrouter.get(\n  '/get/:forumId',\n  paramEmptyValidation(['forumId']),\n  paramUUIDValidation(['forumId']),\n  errorValidator,\n  forumController.getForum\n);", "  forumController.getForum\n);\n\nrouter.get(\n  '/get-all',\n  isAuthenticated,\n  isAdmin,\n  errorValidator,\n  forumController.getAll\n);", "  forumController.getAll\n);\n\nrouter.post(\n  '/create',\n  isAuthenticated,\n  uploadForum,\n  bodyEmptyValidation(['title', 'description']),\n  errorValidator,\n  forumController.createForum", "  errorValidator,\n  forumController.createForum\n);\n\nrouter.patch(\n  '/seen',\n  isAuthenticated,\n  bodyEmptyValidation(['forumId']),\n  bodyUUIDValidation(['forumId']),\n  errorValidator,", "  bodyUUIDValidation(['forumId']),\n  errorValidator,\n  isForumCreator,\n  forumController.forumSeen\n);\n\nrouter.patch(\n  '/update',\n  isAuthenticated,\n  bodyEmptyValidation(['forumId', 'title', 'description']),", "  isAuthenticated,\n  bodyEmptyValidation(['forumId', 'title', 'description']),\n  bodyUUIDValidation(['forumId']),\n  errorValidator,\n  isForumCreator,\n  forumController.updateForum\n);\n\nrouter.delete(\n  '/delete',", "router.delete(\n  '/delete',\n  isAuthenticated,\n  bodyEmptyValidation(['forumId']),\n  bodyUUIDValidation(['forumId']),\n  errorValidator,\n  isForumCreator,\n  forumController.deleteForum\n);\n", ");\n\nexport default router;\n"]}
{"filename": "src/routes/static.file.route.ts", "chunked_list": ["import express, { Router } from \"express\";\nimport path from \"path\";\n\nconst router = Router();\n\nrouter.use(\n  \"/profile-picture\",\n  express.static(path.join(__dirname, \"..\", \"public\", \"profilePicture\"))\n);\nrouter.use(", ");\nrouter.use(\n  \"/forum\",\n  express.static(path.join(__dirname, \"..\", \"public\", \"forum\"))\n);\n\nexport default router;\n"]}
{"filename": "src/routes/activation.link.route.ts", "chunked_list": ["import { Router } from \"express\";\nimport * as activationLinkController from \"../controllers/activation.link.controller\";\nimport {\n  bodyEmptyValidation,\n  bodyUUIDValidation,\n  errorValidator,\n} from \"../middlewares/validator.middleware\";\n\nconst router = Router();\n", "const router = Router();\n\nrouter.patch(\n  \"/activate\",\n  bodyEmptyValidation([\"activationLinkId\"]),\n  bodyUUIDValidation([\"activationLinkId\"]),\n  errorValidator,\n  activationLinkController.activateUser\n);\n", ");\n\nrouter.post(\n  \"/generate\",\n  bodyEmptyValidation([\"userId\", \"activationLinkId\"]),\n  bodyUUIDValidation([\"userId\", \"activationLinkId\"]),\n  errorValidator,\n  activationLinkController.generateActivationLink\n);\n", ");\n\nexport default router;\n"]}
{"filename": "src/routes/index.ts", "chunked_list": ["import { Router } from \"express\";\nimport { isAuthenticated } from \"../middlewares/auth.middleware\";\nimport activationLinkRouter from \"./activation.link.route\";\nimport authRouter from \"./auth.route\";\nimport forumCommentRouter from \"./forum.comment.route\";\nimport forumReplyRouter from \"./forum.reply.route\";\nimport forumRouter from \"./forum.route\";\nimport staticFileRouter from \"./static.file.route\";\nimport userRouter from \"./user.route\";\n", "import userRouter from \"./user.route\";\n\nconst router = Router();\n\nrouter.use(\"/users\", isAuthenticated, userRouter);\nrouter.use(\"/auth\", authRouter);\nrouter.use(\"/activation-links\", activationLinkRouter);\nrouter.use(\"/forums\", forumRouter);\nrouter.use(\"/forum-comments\", forumCommentRouter);\nrouter.use(\"/forum-replies\", isAuthenticated, forumReplyRouter);", "router.use(\"/forum-comments\", forumCommentRouter);\nrouter.use(\"/forum-replies\", isAuthenticated, forumReplyRouter);\nrouter.use(\"/public\", staticFileRouter);\n\nexport default router;\n"]}
{"filename": "src/routes/auth.route.ts", "chunked_list": ["import { Router } from 'express';\nimport * as authController from '../controllers/auth.controller';\nimport {\n  bodyEmailValidation,\n  bodyEmptyValidation,\n  bodyLengthValidation,\n  cookieEmptyValidation,\n  errorValidator,\n} from '../middlewares/validator.middleware';\n", "} from '../middlewares/validator.middleware';\n\nconst router = Router();\n\nrouter.post(\n  '/login',\n  bodyEmptyValidation(['email', 'password']),\n  bodyEmailValidation(['email']),\n  errorValidator,\n  authController.login", "  errorValidator,\n  authController.login\n);\nrouter.post(\n  '/register',\n  bodyEmptyValidation(['email', 'name', 'username', 'password']),\n  bodyEmailValidation(['email']),\n  bodyLengthValidation(['password'], [8], [16]),\n  errorValidator,\n  authController.register", "  errorValidator,\n  authController.register\n);\nrouter.delete(\n  '/logout',\n  cookieEmptyValidation(['refreshToken']),\n  errorValidator,\n  authController.logout\n);\nrouter.get(", ");\nrouter.get(\n  '/token',\n  cookieEmptyValidation(['refreshToken']),\n  errorValidator,\n  authController.refreshToken\n);\nrouter.post(\n  '/login-google-token',\n  bodyEmptyValidation(['token']),", "  '/login-google-token',\n  bodyEmptyValidation(['token']),\n  errorValidator,\n  authController.loginGoogleToken\n);\n\nexport default router;\n"]}
