{"filename": "src/themeObserver.ts", "chunked_list": ["import { refreshBlocks } from 'src/global/blocks';\n\texport const themeObserver = new MutationObserver(function (mutations) {\n\t\tmutations.forEach(function (mutation) {\n\t\t\tconst target = mutation.target as HTMLElement;\n\t\t\tif (\n\t\t\t\t// dark -> dark & light -> light\n\t\t\t\tmutation.oldValue?.contains('theme-dark') &&\n\t\t\t\t!mutation.oldValue?.contains('theme-light') && // key line, avoid calling twice\n\t\t\t\ttarget.classList.value.contains('theme-light')\n\t\t\t) {\n", "\t\t\trefreshBlocks();\n\t\t\t} else if (\n\t\t\t\t// light -> empty -> dark\n\t\t\t\tmutation.oldValue?.contains('theme-light') && // key line, avoid calling twice\n\t\t\t\t!mutation.oldValue?.contains('theme-dark') &&\n\t\t\t\ttarget.classList.value.contains('theme-dark')\n\t\t\t) {\n\t\t\t\trefreshBlocks();\n\t\t\t}\n\t\t});\n", "});\n\texport const setObserver = () => {\n\t\tthemeObserver.observe(document.body, {\n\t\t\tattributes: true,\n\t\t\tattributeOldValue: true,\n\t\t\tattributeFilter: ['class'],\n\t\t});\n\t};\n\texport const detachObserver = () => {\n\t\tthemeObserver.disconnect();\n", "};\n"]}
{"filename": "src/main.ts", "chunked_list": ["import { Plugin, MarkdownPostProcessorContext } from 'obsidian';\n\timport {\n\t\tDEFAULT_SETTINGS,\n\t\tChemPluginSettings,\n\t\tSETTINGS_VERSION,\n\t} from './settings/base';\n\timport { ChemSettingTab } from './settings/SettingTab';\n\timport { updateSettingsVersion } from './settings/update';\n\timport { SmilesBlock } from './SmilesBlock';\n\timport { setBlocks, clearBlocks } from './global/blocks';\n", "import { setDrawer, clearDrawer } from './global/drawer';\n\timport { setObserver, detachObserver } from './themeObserver';\n\texport default class ChemPlugin extends Plugin {\n\t\tsettings: ChemPluginSettings;\n\t\tasync onload() {\n\t\t\tawait this.loadSettings();\n\t\t\t// this.addRibbonIcon('hexagon', 'This is Chem Plugin', () => {});\n\t\t\t// initialize global variables\n\t\t\tsetDrawer(this.settings.options);\n\t\t\tsetBlocks();\n", "\t\tsetObserver();\n\t\t\tthis.addSettingTab(new ChemSettingTab({ app: this.app, plugin: this }));\n\t\t\tthis.registerMarkdownCodeBlockProcessor('smiles', this.smilesProcessor);\n\t\t}\n\t\tasync onunload() {\n\t\t\tdetachObserver();\n\t\t\tclearBlocks();\n\t\t\tclearDrawer();\n\t\t}\n\t\tasync loadSettings() {\n", "\t\tconst candidate = Object.assign({}, await this.loadData());\n\t\t\tif ('version' in candidate && candidate.version == SETTINGS_VERSION)\n\t\t\t\tthis.settings = Object.assign({}, DEFAULT_SETTINGS, candidate);\n\t\t\telse\n\t\t\t\tthis.settings = Object.assign(\n\t\t\t\t\t{},\n\t\t\t\t\tDEFAULT_SETTINGS,\n\t\t\t\t\tupdateSettingsVersion(candidate)\n\t\t\t\t);\n\t\t}\n", "\tasync saveSettings() {\n\t\t\tawait this.saveData(this.settings);\n\t\t}\n\t\tsmilesProcessor = (\n\t\t\tsource: string,\n\t\t\tel: HTMLElement,\n\t\t\tctx: MarkdownPostProcessorContext\n\t\t) => {\n\t\t\tctx.addChild(new SmilesBlock(el, source, ctx, this.settings)); // pass plugin settings, maybe useful in react settings provider.\n\t\t};\n", "}\n"]}
{"filename": "src/global.d.ts", "chunked_list": ["declare module 'smiles-drawer';\n"]}
{"filename": "src/SmilesBlock.ts", "chunked_list": ["import { MarkdownRenderChild, MarkdownPostProcessorContext } from 'obsidian';\n\timport { gDrawer } from './global/drawer';\n\timport { ChemPluginSettings } from './settings/base';\n\timport { addBlock, removeBlock } from './global/blocks';\n\timport { i18n } from 'src/lib/i18n';\n\texport class SmilesBlock extends MarkdownRenderChild {\n\t\tconstructor(\n\t\t\tprivate readonly el: HTMLElement,\n\t\t\tprivate readonly markdownSource: string,\n\t\t\tprivate readonly context: MarkdownPostProcessorContext,\n", "\t\tprivate readonly settings: ChemPluginSettings\n\t\t) {\n\t\t\tsuper(el); // important\n\t\t\taddBlock(this);\n\t\t}\n\t\trender() {\n\t\t\t// TODO: rendering animation\n\t\t\tthis.el.empty();\n\t\t\tconst rows = this.markdownSource\n\t\t\t\t.split('\\n')\n", "\t\t\t.filter((row) => row.length > 0)\n\t\t\t\t.map((row) => row.trim());\n\t\t\tif (rows.length == 1) {\n\t\t\t\tconst div = this.el.createDiv({ cls: 'chem-cell' });\n\t\t\t\tthis.renderCell(rows[0], div);\n\t\t\t} else {\n\t\t\t\tconst table = this.el.createDiv({ cls: 'chem-table' });\n\t\t\t\tconst maxWidth = this.settings.options?.width ?? 300;\n\t\t\t\trows.forEach((row) => {\n\t\t\t\t\tconst cell = table.createDiv({ cls: 'chem-cell' });\n", "\t\t\t\tconst svgcell = this.renderCell(row, cell);\n\t\t\t\t\tif (parseFloat(svgcell.style.width) > maxWidth)\n\t\t\t\t\t\tsvgcell.style.width = `${maxWidth.toString()}px`;\n\t\t\t\t});\n\t\t\t\ttable.style.gridTemplateColumns = `repeat(auto-fill, minmax(${\n\t\t\t\t\tthis.settings.options.width?.toString() ?? '300'\n\t\t\t\t}px, 1fr)`;\n\t\t\t}\n\t\t}\n\t\tprivate renderCell = (source: string, target: HTMLElement) => {\n", "\t\tconst svg = target.createSvg('svg');\n\t\t\tgDrawer.draw(\n\t\t\t\tsource,\n\t\t\t\tsvg,\n\t\t\t\tdocument.body.hasClass('theme-dark') &&\n\t\t\t\t\t!document.body.hasClass('theme-light')\n\t\t\t\t\t? this.settings.darkTheme\n\t\t\t\t\t: this.settings.lightTheme,\n\t\t\t\tnull,\n\t\t\t\t(error: object & { name: string; message: string }) => {\n", "\t\t\t\ttarget.empty();\n\t\t\t\t\tconst ErrorContainer = target.createEl('div');\n\t\t\t\t\tErrorContainer.createDiv('error-source').setText(\n\t\t\t\t\t\ti18n.t('errors.source.title', { source: source })\n\t\t\t\t\t);\n\t\t\t\t\tErrorContainer.createEl('br');\n\t\t\t\t\tconst ErrorInfo = ErrorContainer.createEl('details');\n\t\t\t\t\tErrorInfo.createEl('summary').setText(error.name);\n\t\t\t\t\tErrorInfo.createEl('div').setText(error.message);\n\t\t\t\t\tErrorContainer.style.wordBreak = `break-word`;\n", "\t\t\t\tErrorContainer.style.userSelect = `text`;\n\t\t\t\t\t//TODO: in multiline block, keep the width sync with the grid setting\n\t\t\t\t\tif (this.settings.options.scale == 0)\n\t\t\t\t\t\tErrorContainer.style.width = `${\n\t\t\t\t\t\t\tthis.settings?.imgWidth.toString() ?? '300'\n\t\t\t\t\t\t}px`;\n\t\t\t\t\telse if (\n\t\t\t\t\t\tErrorContainer.offsetWidth >\n\t\t\t\t\t\t(this.settings.options?.width ?? 300)\n\t\t\t\t\t) {\n", "\t\t\t\t\tErrorContainer.style.width = `${(\n\t\t\t\t\t\t\tthis.settings.options?.width ?? 300\n\t\t\t\t\t\t).toString()}px`;\n\t\t\t\t\t\tErrorContainer.style.height = `${(\n\t\t\t\t\t\t\tthis.settings.options?.height ?? 300\n\t\t\t\t\t\t).toString()}px`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tif (this.settings.options.scale == 0)\n", "\t\t\tsvg.style.width = `${this.settings.imgWidth.toString()}px`;\n\t\t\treturn svg;\n\t\t};\n\t\tasync onload() {\n\t\t\tthis.render();\n\t\t}\n\t\tonunload() {\n\t\t\tremoveBlock(this); // remove from global block list\n\t\t}\n\t}\n"]}
{"filename": "src/settings/base.ts", "chunked_list": ["// Global consts\n\texport const SAMPLE_SMILES_1 = 'OC(=O)C(C)=CC1=CC=CC=C1';\n\texport const SAMPLE_SMILES_2 =\n\t\t'OC(C(=O)O[C@H]1C[N+]2(CCCOC3=CC=CC=C3)CCC1CC2)(C1=CC=CS1)C1=CC=CS1';\n\texport const SETTINGS_VERSION = 'v2';\n\t// Plugin settings\n\texport interface ChemPluginSettings {\n\t\tversion: string;\n\t\tdarkTheme: string;\n\t\tlightTheme: string;\n", "\tsample1: string;\n\t\tsample2: string;\n\t\timgWidth: number;\n\t\toptions: Partial<SMILES_DRAWER_OPTIONS>;\n\t}\n\texport const DEFAULT_SETTINGS: ChemPluginSettings = {\n\t\tversion: SETTINGS_VERSION,\n\t\tdarkTheme: 'dark',\n\t\tlightTheme: 'light',\n\t\tsample1: SAMPLE_SMILES_1,\n", "\tsample2: SAMPLE_SMILES_2,\n\t\timgWidth: 300,\n\t\toptions: {},\n\t};\n\t// Smiles-drawer options\n\t// Reference: https://smilesdrawer.surge.sh/playground.html\n\texport interface SMILES_DRAWER_OPTIONS {\n\t\twidth: number;\n\t\theight: number;\n\t\tscale: number;\n", "\tbondThickness: number;\n\t\tshortBondLength: number;\n\t\tbondSpacing: number;\n\t\tatomVisualization: 'default' | 'balls' | 'allballs';\n\t\tisomeric: boolean;\n\t\tdebug: boolean;\n\t\tterminalCarbons: boolean;\n\t\texplicitHydrogens: boolean;\n\t\toverlapSensitivity: number;\n\t\toverlapResolutionIterations: number;\n", "\tcompactDrawing: boolean;\n\t\tfontFamily: string;\n\t\tfontSizeLarge: number;\n\t\tfontSizeSmall: number;\n\t\tpadding: number;\n\t\texperimentalSSSR: boolean;\n\t\tkkThreshold: number;\n\t\tkkInnerThreshold: number;\n\t\tkkMaxIteration: number;\n\t\tkkMaxInnerIteration: number;\n", "\tkkMaxEnergy: number;\n\t\tthemes: object;\n\t}\n\texport const DEFAULT_SD_OPTIONS: SMILES_DRAWER_OPTIONS = {\n\t\twidth: 300,\n\t\theight: 300,\n\t\tscale: 1.0,\n\t\tbondThickness: 1,\n\t\tshortBondLength: 0.8,\n\t\tbondSpacing: 5.1,\n", "\tatomVisualization: 'default',\n\t\tisomeric: true,\n\t\tdebug: false,\n\t\tterminalCarbons: false,\n\t\texplicitHydrogens: true,\n\t\toverlapSensitivity: 0.42,\n\t\toverlapResolutionIterations: 1,\n\t\tcompactDrawing: false,\n\t\tfontFamily: 'Arial, Helvetica, sans-serif',\n\t\tfontSizeLarge: 11,\n", "\tfontSizeSmall: 3,\n\t\tpadding: 2,\n\t\texperimentalSSSR: true,\n\t\tkkThreshold: 0.1,\n\t\tkkInnerThreshold: 0.1,\n\t\tkkMaxIteration: 20000,\n\t\tkkMaxInnerIteration: 50,\n\t\tkkMaxEnergy: 1000000000,\n\t\tthemes: {\n\t\t\tdark: {\n", "\t\t\tC: '#fff',\n\t\t\t\tO: '#e74c3c',\n\t\t\t\tN: '#3498db',\n\t\t\t\tF: '#27ae60',\n\t\t\t\tCL: '#16a085',\n\t\t\t\tBR: '#d35400',\n\t\t\t\tI: '#8e44ad',\n\t\t\t\tP: '#d35400',\n\t\t\t\tS: '#f1c40f',\n\t\t\t\tB: '#e67e22',\n", "\t\t\tSI: '#e67e22',\n\t\t\t\tH: '#aaa',\n\t\t\t\tBACKGROUND: '#141414',\n\t\t\t},\n\t\t\tlight: {\n\t\t\t\tC: '#222',\n\t\t\t\tO: '#e74c3c',\n\t\t\t\tN: '#3498db',\n\t\t\t\tF: '#27ae60',\n\t\t\t\tCL: '#16a085',\n", "\t\t\tBR: '#d35400',\n\t\t\t\tI: '#8e44ad',\n\t\t\t\tP: '#d35400',\n\t\t\t\tS: '#f1c40f',\n\t\t\t\tB: '#e67e22',\n\t\t\t\tSI: '#e67e22',\n\t\t\t\tH: '#666',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\toldschool: {\n", "\t\t\tC: '#000',\n\t\t\t\tO: '#000',\n\t\t\t\tN: '#000',\n\t\t\t\tF: '#000',\n\t\t\t\tCL: '#000',\n\t\t\t\tBR: '#000',\n\t\t\t\tI: '#000',\n\t\t\t\tP: '#000',\n\t\t\t\tS: '#000',\n\t\t\t\tB: '#000',\n", "\t\t\tSI: '#000',\n\t\t\t\tH: '#000',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\t'oldschool-dark': {\n\t\t\t\tC: '#fff',\n\t\t\t\tO: '#fff',\n\t\t\t\tN: '#fff',\n\t\t\t\tF: '#fff',\n\t\t\t\tCL: '#fff',\n", "\t\t\tBR: '#fff',\n\t\t\t\tI: '#fff',\n\t\t\t\tP: '#fff',\n\t\t\t\tS: '#fff',\n\t\t\t\tB: '#fff',\n\t\t\t\tSI: '#fff',\n\t\t\t\tH: '#fff',\n\t\t\t\tBACKGROUND: '#000',\n\t\t\t},\n\t\t\tsolarized: {\n", "\t\t\tC: '#586e75',\n\t\t\t\tO: '#dc322f',\n\t\t\t\tN: '#268bd2',\n\t\t\t\tF: '#859900',\n\t\t\t\tCL: '#16a085',\n\t\t\t\tBR: '#cb4b16',\n\t\t\t\tI: '#6c71c4',\n\t\t\t\tP: '#d33682',\n\t\t\t\tS: '#b58900',\n\t\t\t\tB: '#2aa198',\n", "\t\t\tSI: '#2aa198',\n\t\t\t\tH: '#657b83',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\t'solarized-dark': {\n\t\t\t\tC: '#93a1a1',\n\t\t\t\tO: '#dc322f',\n\t\t\t\tN: '#268bd2',\n\t\t\t\tF: '#859900',\n\t\t\t\tCL: '#16a085',\n", "\t\t\tBR: '#cb4b16',\n\t\t\t\tI: '#6c71c4',\n\t\t\t\tP: '#d33682',\n\t\t\t\tS: '#b58900',\n\t\t\t\tB: '#2aa198',\n\t\t\t\tSI: '#2aa198',\n\t\t\t\tH: '#839496',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\tmatrix: {\n", "\t\t\tC: '#678c61',\n\t\t\t\tO: '#2fc079',\n\t\t\t\tN: '#4f7e7e',\n\t\t\t\tF: '#90d762',\n\t\t\t\tCL: '#82d967',\n\t\t\t\tBR: '#23755a',\n\t\t\t\tI: '#409931',\n\t\t\t\tP: '#c1ff8a',\n\t\t\t\tS: '#faff00',\n\t\t\t\tB: '#50b45a',\n", "\t\t\tSI: '#409931',\n\t\t\t\tH: '#426644',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\tgithub: {\n\t\t\t\tC: '#24292f',\n\t\t\t\tO: '#cf222e',\n\t\t\t\tN: '#0969da',\n\t\t\t\tF: '#2da44e',\n\t\t\t\tCL: '#6fdd8b',\n", "\t\t\tBR: '#bc4c00',\n\t\t\t\tI: '#8250df',\n\t\t\t\tP: '#bf3989',\n\t\t\t\tS: '#d4a72c',\n\t\t\t\tB: '#fb8f44',\n\t\t\t\tSI: '#bc4c00',\n\t\t\t\tH: '#57606a',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\tcarbon: {\n", "\t\t\tC: '#161616',\n\t\t\t\tO: '#da1e28',\n\t\t\t\tN: '#0f62fe',\n\t\t\t\tF: '#198038',\n\t\t\t\tCL: '#007d79',\n\t\t\t\tBR: '#fa4d56',\n\t\t\t\tI: '#8a3ffc',\n\t\t\t\tP: '#ff832b',\n\t\t\t\tS: '#f1c21b',\n\t\t\t\tB: '#8a3800',\n", "\t\t\tSI: '#e67e22',\n\t\t\t\tH: '#525252',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\tcyberpunk: {\n\t\t\t\tC: '#ea00d9',\n\t\t\t\tO: '#ff3131',\n\t\t\t\tN: '#0abdc6',\n\t\t\t\tF: '#00ff9f',\n\t\t\t\tCL: '#00fe00',\n", "\t\t\tBR: '#fe9f20',\n\t\t\t\tI: '#ff00ff',\n\t\t\t\tP: '#fe7f00',\n\t\t\t\tS: '#fcee0c',\n\t\t\t\tB: '#ff00ff',\n\t\t\t\tSI: '#ffffff',\n\t\t\t\tH: '#913cb1',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t\tgruvbox: {\n", "\t\t\tC: '#665c54',\n\t\t\t\tO: '#cc241d',\n\t\t\t\tN: '#458588',\n\t\t\t\tF: '#98971a',\n\t\t\t\tCL: '#79740e',\n\t\t\t\tBR: '#d65d0e',\n\t\t\t\tI: '#b16286',\n\t\t\t\tP: '#af3a03',\n\t\t\t\tS: '#d79921',\n\t\t\t\tB: '#689d6a',\n", "\t\t\tSI: '#427b58',\n\t\t\t\tH: '#7c6f64',\n\t\t\t\tBACKGROUND: '#fbf1c7',\n\t\t\t},\n\t\t\t'gruvbox-dark': {\n\t\t\t\tC: '#ebdbb2',\n\t\t\t\tO: '#cc241d',\n\t\t\t\tN: '#458588',\n\t\t\t\tF: '#98971a',\n\t\t\t\tCL: '#b8bb26',\n", "\t\t\tBR: '#d65d0e',\n\t\t\t\tI: '#b16286',\n\t\t\t\tP: '#fe8019',\n\t\t\t\tS: '#d79921',\n\t\t\t\tB: '#8ec07c',\n\t\t\t\tSI: '#83a598',\n\t\t\t\tH: '#bdae93',\n\t\t\t\tBACKGROUND: '#282828',\n\t\t\t},\n\t\t\tcustom: {\n", "\t\t\tC: '#222',\n\t\t\t\tO: '#e74c3c',\n\t\t\t\tN: '#3498db',\n\t\t\t\tF: '#27ae60',\n\t\t\t\tCL: '#16a085',\n\t\t\t\tBR: '#d35400',\n\t\t\t\tI: '#8e44ad',\n\t\t\t\tP: '#d35400',\n\t\t\t\tS: '#f1c40f',\n\t\t\t\tB: '#e67e22',\n", "\t\t\tSI: '#e67e22',\n\t\t\t\tH: '#666',\n\t\t\t\tBACKGROUND: '#fff',\n\t\t\t},\n\t\t},\n\t};\n\texport const themeList = {\n\t\tlight: 'Light',\n\t\tdark: 'Dark',\n\t\toldschool: 'Oldschool',\n", "\t'oldschool-dark': 'Oldschool Dark',\n\t\tsolarized: 'Solarized',\n\t\t'solarized-dark': 'Solarized Dark',\n\t\tmatrix: 'Matrix',\n\t\tgithub: 'GitHub',\n\t\tcarbon: 'Carbon',\n\t\tcyberpunk: 'Cyberpunk',\n\t\tgruvbox: 'Gruvbox',\n\t\t'gruvbox-dark': 'Gruvbox Dark',\n\t};\n"]}
{"filename": "src/settings/LivePreview.ts", "chunked_list": ["import { ChemPluginSettings } from '../settings/base';\n\timport { gDrawer } from 'src/global/drawer';\n\timport { i18n } from 'src/lib/i18n';\n\texport class LivePreview {\n\t\tcontainer: HTMLDivElement;\n\t\tlightCard: HTMLDivElement;\n\t\tdarkCard: HTMLDivElement;\n\t\tsettings: ChemPluginSettings;\n\t\tconstructor(\n\t\t\tprivate readonly el: HTMLElement,\n", "\t\tprivate readonly argSettings: ChemPluginSettings\n\t\t) {\n\t\t\tthis.container = this.el.createEl('div');\n\t\t\tthis.container.style.display = `flex`;\n\t\t\tthis.container.style.flexWrap = `wrap`;\n\t\t\tthis.container.style.justifyContent = `center`;\n\t\t\tthis.lightCard = this.container.createEl('div', {\n\t\t\t\tcls: 'chemcard theme-light',\n\t\t\t});\n\t\t\tthis.darkCard = this.container.createEl('div', {\n", "\t\t\tcls: 'chemcard theme-dark',\n\t\t\t});\n\t\t\tthis.settings = this.argSettings;\n\t\t}\n\t\trender = () => {\n\t\t\tthis.lightCard.empty();\n\t\t\tconst lightWidth = this.renderCell(\n\t\t\t\tthis.settings.sample1,\n\t\t\t\tthis.lightCard,\n\t\t\t\tthis.settings.lightTheme\n", "\t\t);\n\t\t\tthis.darkCard.empty();\n\t\t\tconst darkWidth = this.renderCell(\n\t\t\t\tthis.settings.sample2,\n\t\t\t\tthis.darkCard,\n\t\t\t\tthis.settings.darkTheme\n\t\t\t);\n\t\t\tif (this.settings.options.scale == 0)\n\t\t\t\tthis.container.style.gridTemplateColumns = `repeat(auto-fill, minmax(${\n\t\t\t\t\tthis.settings?.imgWidth.toString() ?? '300'\n", "\t\t\t}px, 1fr)`;\n\t\t\telse\n\t\t\t\tthis.container.style.gridTemplateColumns = `repeat(auto-fill, minmax(${(lightWidth >\n\t\t\t\tdarkWidth\n\t\t\t\t\t? lightWidth\n\t\t\t\t\t: darkWidth\n\t\t\t\t).toString()}px, 1fr)`;\n\t\t};\n\t\tupdateSettings = (argSettings: ChemPluginSettings) => {\n\t\t\tthis.settings = argSettings;\n", "\t};\n\t\tprivate renderCell = (\n\t\t\tsource: string,\n\t\t\ttarget: HTMLElement,\n\t\t\tstyle: string\n\t\t) => {\n\t\t\tconst svg = target.createSvg('svg');\n\t\t\tgDrawer.draw(\n\t\t\t\tsource,\n\t\t\t\tsvg,\n", "\t\t\tstyle,\n\t\t\t\tnull,\n\t\t\t\t(error: object & { name: string; message: string }) => {\n\t\t\t\t\ttarget.empty();\n\t\t\t\t\tconst ErrorContainer = target.createEl('div');\n\t\t\t\t\tErrorContainer.createDiv('error-source').setText(\n\t\t\t\t\t\ti18n.t('errors.source.title', { source: source })\n\t\t\t\t\t);\n\t\t\t\t\tErrorContainer.createEl('br');\n\t\t\t\t\tconst ErrorInfo = ErrorContainer.createEl('details');\n", "\t\t\t\tErrorInfo.createEl('summary').setText(error.name);\n\t\t\t\t\tErrorInfo.createEl('div').setText(error.message);\n\t\t\t\t\tErrorContainer.style.wordBreak = `break-word`;\n\t\t\t\t\tErrorContainer.style.userSelect = `text`;\n\t\t\t\t\tErrorContainer.style.display = `grid`;\n\t\t\t\t\tErrorContainer.style.alignContent = `center`;\n\t\t\t\t\tif (this.settings.options.scale == 0)\n\t\t\t\t\t\tErrorContainer.style.width = `${\n\t\t\t\t\t\t\tthis.settings?.imgWidth.toString() ?? '300'\n\t\t\t\t\t\t}px`;\n", "\t\t\t\telse if (\n\t\t\t\t\t\tErrorContainer.offsetWidth >\n\t\t\t\t\t\t(this.settings.options?.width ?? 300)\n\t\t\t\t\t) {\n\t\t\t\t\t\tErrorContainer.style.width = `${(\n\t\t\t\t\t\t\tthis.settings.options?.width ?? 300\n\t\t\t\t\t\t).toString()}px`;\n\t\t\t\t\t\tErrorContainer.style.height = `${(\n\t\t\t\t\t\t\tthis.settings.options?.height ?? 300\n\t\t\t\t\t\t).toString()}px`;\n", "\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tif (this.settings.options.scale == 0)\n\t\t\t\tsvg.style.width = `${\n\t\t\t\t\tthis.settings?.imgWidth.toString() ?? '300'\n\t\t\t\t}px`;\n\t\t\telse if (\n\t\t\t\tparseFloat(svg.style.width) > (this.settings.options?.width ?? 300)\n\t\t\t) {\n", "\t\t\tsvg.style.width = `${(\n\t\t\t\t\tthis.settings.options?.width ?? 300\n\t\t\t\t).toString()}px`;\n\t\t\t\tsvg.style.height = `${(\n\t\t\t\t\tthis.settings.options?.height ?? 300\n\t\t\t\t).toString()}px`;\n\t\t\t}\n\t\t\treturn parseFloat(svg.style.width);\n\t\t};\n\t}\n"]}
{"filename": "src/settings/update.ts", "chunked_list": ["interface ChemPluginSettingsV1 {\n\t\tdarkTheme: string;\n\t\tlightTheme: string;\n\t\tsample: string;\n\t\twidth: string;\n\t}\n\t// const DEFAULT_SETTINGS_V1: ChemPluginSettingsV1 = {\n\t// \tdarkTheme: 'dark',\n\t// \tlightTheme: 'light',\n\t// \tsample: 'CC(=O)NC1=C-C=C-C=C1-C(=O)O',\n", "// \twidth: '300',\n\t// };\n\tinterface ChemPluginSettingsV2 {\n\t\tversion: string;\n\t\tdarkTheme: string;\n\t\tlightTheme: string;\n\t\tsample1: string;\n\t\tsample2: string;\n\t\timgWidth: number;\n\t\toptions: object;\n", "}\n\tconst DEFAULT_SETTINGS_V2: ChemPluginSettingsV2 = {\n\t\tversion: 'v2',\n\t\tdarkTheme: 'dark',\n\t\tlightTheme: 'light',\n\t\tsample1: 'OC(=O)C(C)=CC1=CC=CC=C1',\n\t\tsample2:\n\t\t\t'OC(C(=O)O[C@H]1C[N+]2(CCCOC3=CC=CC=C3)CCC1CC2)(C1=CC=CS1)C1=CC=CS1',\n\t\timgWidth: 300,\n\t\toptions: {},\n", "};\n\texport const updateSettingsVersion = (stale: ChemPluginSettingsV1) => {\n\t\tconst result = { ...DEFAULT_SETTINGS_V2 };\n\t\tresult.darkTheme = stale.darkTheme;\n\t\tresult.lightTheme = stale.lightTheme;\n\t\tresult.sample1 = stale.sample;\n\t\tresult.imgWidth = parseInt(stale.width);\n\t\treturn result;\n\t};\n"]}
{"filename": "src/settings/SettingTab.ts", "chunked_list": ["import { App, PluginSettingTab, Setting, SliderComponent } from 'obsidian';\n\timport ChemPlugin from '../main';\n\timport {\n\t\tDEFAULT_SD_OPTIONS,\n\t\tSAMPLE_SMILES_1,\n\t\tSAMPLE_SMILES_2,\n\t\tthemeList,\n\t} from './base';\n\timport { setDrawer } from 'src/global/drawer';\n\timport { refreshBlocks } from 'src/global/blocks';\n", "import { LivePreview } from './LivePreview';\n\timport { i18n } from 'src/lib/i18n';\n\t// Reference: https://smilesdrawer.surge.sh/playground.html\n\texport class ChemSettingTab extends PluginSettingTab {\n\t\tplugin: ChemPlugin;\n\t\tconstructor({ app, plugin }: { app: App; plugin: ChemPlugin }) {\n\t\t\tsuper(app, plugin);\n\t\t\tthis.plugin = plugin;\n\t\t}\n\t\tdisplay(): void {\n", "\t\tconst { containerEl } = this;\n\t\t\tcontainerEl.empty();\n\t\t\tconst scaleSetting = new Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.scale.name'))\n\t\t\t\t.setDesc(i18n.t('settings.scale.description'))\n\t\t\t\t.addExtraButton((button) => {\n\t\t\t\t\tbutton\n\t\t\t\t\t\t.setIcon('rotate-ccw')\n\t\t\t\t\t\t.setTooltip(i18n.t('settings.scale.description'))\n\t\t\t\t\t\t.onClick(async () => {\n", "\t\t\t\t\t\tthis.plugin.settings.options.scale = 1;\n\t\t\t\t\t\t\tscaleSlider.setValue(50);\n\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\tsetDrawer({\n\t\t\t\t\t\t\t\t...DEFAULT_SD_OPTIONS,\n\t\t\t\t\t\t\t\t...this.plugin.settings.options,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t\tunifyBondLength();\n\t\t\t\t\t\t});\n", "\t\t\t});\n\t\t\tconst scaleLabel = scaleSetting.controlEl.createDiv('slider-readout');\n\t\t\tscaleLabel.setText(\n\t\t\t\t(this.plugin.settings.options.scale ?? 1.0).toFixed(2).toString()\n\t\t\t);\n\t\t\tconst scaleSlider = new SliderComponent(scaleSetting.controlEl)\n\t\t\t\t.setValue(50 * (this.plugin.settings.options.scale ?? 1.0))\n\t\t\t\t.setLimits(0.0, 100, 0.5)\n\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\tthis.plugin.settings.options.scale = value / 50;\n", "\t\t\t\tscaleLabel.setText((value / 50).toFixed(2).toString());\n\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\tsetDrawer({\n\t\t\t\t\t\t...DEFAULT_SD_OPTIONS,\n\t\t\t\t\t\t...this.plugin.settings.options,\n\t\t\t\t\t});\n\t\t\t\t\tonSettingsChange();\n\t\t\t\t\tif (value == 0) unifyImageWidth();\n\t\t\t\t\telse unifyBondLength();\n\t\t\t\t});\n", "\t\tconst widthSettings = new Setting(containerEl);\n\t\t\tnew Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.theme.light.name'))\n\t\t\t\t.setDesc(i18n.t('settings.theme.light.description'))\n\t\t\t\t.addDropdown((dropdown) =>\n\t\t\t\t\tdropdown\n\t\t\t\t\t\t.addOptions(themeList)\n\t\t\t\t\t\t.setValue(this.plugin.settings.lightTheme)\n\t\t\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\t\t\tthis.plugin.settings.lightTheme = value;\n", "\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\tnew Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.theme.dark.name'))\n\t\t\t\t.setDesc(i18n.t('settings.theme.dark.description'))\n\t\t\t\t.addDropdown((dropdown) =>\n\t\t\t\t\tdropdown\n\t\t\t\t\t\t.addOptions(themeList)\n", "\t\t\t\t\t.setValue(this.plugin.settings.darkTheme)\n\t\t\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\t\t\tthis.plugin.settings.darkTheme = value;\n\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\tnew Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.preview.title'))\n\t\t\t\t.setHeading();\n", "\t\tnew Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.preview.sample.name'))\n\t\t\t\t.setDesc(i18n.t('settings.preview.sample.description'))\n\t\t\t\t.addText((text) =>\n\t\t\t\t\ttext\n\t\t\t\t\t\t.setPlaceholder(SAMPLE_SMILES_1)\n\t\t\t\t\t\t.setValue(this.plugin.settings.sample1)\n\t\t\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\t\t\tif (value == '') {\n\t\t\t\t\t\t\t\tvalue = SAMPLE_SMILES_1;\n", "\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.plugin.settings.sample1 = value;\n\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t\t.addText((text) =>\n\t\t\t\t\ttext\n\t\t\t\t\t\t.setPlaceholder(SAMPLE_SMILES_2)\n\t\t\t\t\t\t.setValue(this.plugin.settings.sample2)\n", "\t\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\t\t\tif (value == '') {\n\t\t\t\t\t\t\t\tvalue = SAMPLE_SMILES_2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.plugin.settings.sample2 = value;\n\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\tconst preview = new LivePreview(containerEl, this.plugin.settings);\n", "\t\tnew Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.advanced.title'))\n\t\t\t\t.setHeading();\n\t\t\tnew Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.advanced.compact-drawing.name'))\n\t\t\t\t.setDesc(i18n.t('settings.advanced.compact-drawing.description'))\n\t\t\t\t.addToggle((toggle) =>\n\t\t\t\t\ttoggle\n\t\t\t\t\t\t.setValue(\n\t\t\t\t\t\t\tthis.plugin.settings.options?.compactDrawing ?? false\n", "\t\t\t\t\t)\n\t\t\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\t\t\tthis.plugin.settings.options.compactDrawing = value;\n\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\tsetDrawer({\n\t\t\t\t\t\t\t\t...DEFAULT_SD_OPTIONS,\n\t\t\t\t\t\t\t\t...this.plugin.settings.options,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t})\n", "\t\t\t);\n\t\t\tnew Setting(containerEl)\n\t\t\t\t.setName(i18n.t('settings.advanced.terminal-carbons.name'))\n\t\t\t\t.setDesc(i18n.t('settings.advanced.terminal-carbons.description'))\n\t\t\t\t.addToggle((toggle) =>\n\t\t\t\t\ttoggle\n\t\t\t\t\t\t.setValue(\n\t\t\t\t\t\t\tthis.plugin.settings.options?.terminalCarbons ?? false\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.onChange(async (value) => {\n", "\t\t\t\t\t\tthis.plugin.settings.options.terminalCarbons = value;\n\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\tsetDrawer({\n\t\t\t\t\t\t\t\t...DEFAULT_SD_OPTIONS,\n\t\t\t\t\t\t\t\t...this.plugin.settings.options,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\tconst onSettingsChange = () => {\n", "\t\t\tpreview.updateSettings(this.plugin.settings);\n\t\t\t\tpreview.render();\n\t\t\t};\n\t\t\tconst unifyBondLength = () => {\n\t\t\t\twidthSettings.controlEl.empty();\n\t\t\t\twidthSettings\n\t\t\t\t\t.setName(i18n.t('settings.unify-bond-length.name'))\n\t\t\t\t\t.setDesc(i18n.t('settings.unify-bond-length.description'))\n\t\t\t\t\t.addText((text) =>\n\t\t\t\t\t\ttext\n", "\t\t\t\t\t\t.setValue(\n\t\t\t\t\t\t\t\tthis.plugin.settings.options.width?.toString() ??\n\t\t\t\t\t\t\t\t\t'300'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\t\t\t\tif (value == '') {\n\t\t\t\t\t\t\t\t\tvalue = '300';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.plugin.settings.options.width =\n\t\t\t\t\t\t\t\t\tparseInt(value);\n", "\t\t\t\t\t\t\tthis.plugin.settings.options.height =\n\t\t\t\t\t\t\t\t\tparseInt(value);\n\t\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\t\tsetDrawer({\n\t\t\t\t\t\t\t\t\t...DEFAULT_SD_OPTIONS,\n\t\t\t\t\t\t\t\t\t...this.plugin.settings.options,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t);\n", "\t\t};\n\t\t\tconst unifyImageWidth = () => {\n\t\t\t\twidthSettings.controlEl.empty();\n\t\t\t\twidthSettings\n\t\t\t\t\t.setName(i18n.t('settings.unify-bond-length.name'))\n\t\t\t\t\t.setDesc(i18n.t('settings.unify-bond-length.description'))\n\t\t\t\t\t.addText((text) => {\n\t\t\t\t\t\ttext.setValue(\n\t\t\t\t\t\t\tthis.plugin.settings?.imgWidth.toString() ?? '300'\n\t\t\t\t\t\t)\n", "\t\t\t\t\t\t.setPlaceholder('300')\n\t\t\t\t\t\t\t.onChange(async (value) => {\n\t\t\t\t\t\t\t\tif (value == '') {\n\t\t\t\t\t\t\t\t\tvalue = '300';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.plugin.settings.imgWidth = parseInt(value);\n\t\t\t\t\t\t\t\tawait this.plugin.saveSettings();\n\t\t\t\t\t\t\t\tonSettingsChange();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n", "\t\t};\n\t\t\t// initialize\n\t\t\tpreview.render();\n\t\t\tif ((this.plugin.settings.options?.scale ?? 1) == 0) unifyImageWidth();\n\t\t\telse unifyBondLength();\n\t\t}\n\t\thide(): void {\n\t\t\trefreshBlocks();\n\t\t}\n\t}\n"]}
{"filename": "src/global/drawer.ts", "chunked_list": ["import { DEFAULT_SD_OPTIONS, SMILES_DRAWER_OPTIONS } from 'src/settings/base';\n\timport SmilesDrawer from 'smiles-drawer';\n\texport let gDrawer = new SmilesDrawer.SmiDrawer(DEFAULT_SD_OPTIONS);\n\texport const setDrawer = (options: Partial<SMILES_DRAWER_OPTIONS>) => {\n\t\tgDrawer = new SmilesDrawer.SmiDrawer({ ...DEFAULT_SD_OPTIONS, ...options });\n\t};\n\texport const clearDrawer = () => {\n\t\tgDrawer = {};\n\t};\n"]}
{"filename": "src/global/blocks.ts", "chunked_list": ["import { SmilesBlock } from '../SmilesBlock';\n\texport let gBlocks: SmilesBlock[];\n\texport const setBlocks = () => {\n\t\tgBlocks = new Array<SmilesBlock>();\n\t};\n\texport const addBlock = (block: SmilesBlock) => {\n\t\tgBlocks.push(block);\n\t};\n\texport const removeBlock = (block: SmilesBlock) => {\n\t\tif (gBlocks.indexOf(block) != -1) gBlocks.splice(gBlocks.indexOf(block), 1);\n", "};\n\t// TODO: late refresh\n\t// this manager will get all the living instances\n\t// however, we only want to see the instances refreshed when the file is activated\n\t// file info is in the ctx of the block, and activate attribute is in the leaf metadata\n\texport const refreshBlocks = () => {\n\t\tgBlocks.forEach((block) => {\n\t\t\tblock.render();\n\t\t});\n\t};\n", "export const clearBlocks = () => {\n\t\tgBlocks.forEach((block) => {\n\t\t\tremoveBlock(block);\n\t\t});\n\t};\n"]}
{"filename": "src/lib/i18n.ts", "chunked_list": ["import i18next from 'i18next';\n\timport * as en from 'src/lib/translations/en.json';\n\timport * as zh_CN from 'src/lib/translations/zh-CN.json';\n\timport { moment } from 'obsidian';\n\ti18next.init({\n\t\tlng: moment.locale(),\n\t\tfallbackLng: {\n\t\t\t'zh-TW': ['zh-CN', 'en'],\n\t\t\tdefault: ['en'],\n\t\t},\n", "\tresources: {\n\t\t\ten: en,\n\t\t\t'zh-CN': zh_CN,\n\t\t},\n\t});\n\texport const i18n = i18next;\n"]}
